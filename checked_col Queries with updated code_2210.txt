38)

SELECT  APPT_FCT.[WORKER APPOINTMENT ASSOCIATION],   APPT_FCT.[APPOINTMENT DIMENSION SURROGATE KEY],  APPT_FCT.[PERSON DIMENSION SURROGATE KEY],  SUM(APPT_FCT.[APPOINTMENT OCCURS]) [APPT_OCCURS],  MBR_DIM.[MEMBERSHIP TYPE CODE],  MBR_DIM.[MEMBERSHIP TYPE DESCRIPTION],  APPT_DIM.[APPOINTMENT DATE],  APPT_DIM.[APPOINTMENT TYPE CODE],  CASE WHEN APPT_DIM.[APPOINTMENT TYPE CODE] IN ('GATHER DATA') THEN 'DISCOVER'             WHEN APPT_DIM.[APPOINTMENT TYPE CODE] IN ('TAKE ACTION') THEN 'DELIVER'             WHEN APPT_DIM.[APPOINTMENT TYPE CODE] NOT IN ('GATHER DATA','TAKE ACTION') THEN APPT_DIM.[APPOINTMENT TYPE CODE]        END AS [APPOINTMENT TYPE CODE],        CASE WHEN APPT_DIM.[APPOINTMENT TYPE CODE] IN ('GATHER DATA') THEN 'DISCOVER'             WHEN APPT_DIM.[APPOINTMENT TYPE CODE] IN ('TAKE ACTION') THEN 'DELIVER'             WHEN APPT_DIM.[APPOINTMENT TYPE CODE] NOT IN ('GATHER DATA','TAKE ACTION') THEN APPT_DIM.[APPOINTMENT TYPE DESCRIPTION]        END AS [APPOINTMENT TYPE DESCRIPTION],   CASE WHEN APPT_DIM.[FIELD USER COUNT] <> 0 AND APPT_DIM.[APPOINTMENT TYPE CODE] IN ('CONNECT','GATHER DATA','TAKE ACTION','STRATEGY CALL/MEETING','REVIEW','SERVICE','DISCOVER','DELIVER')    THEN 1     ELSE 0    END [JFW_IND],  DATE_DIM.[CALENDAR YEAR NAME],  DATE_DIM.[CALENDAR YEAR WEEK NUMBER],  DATE_DIM.[CALENDAR WEEK END DATE],  (LEFT(SALE_HIER_DIM.[ORZN_ZONE_CDE],4)) AS RFO,  SALE_HIER_DIM.ORZN_ZONE_CDE [MARKET],          SALE_HIER_DIM.ORZN_SUB_DEPT_CDE [MVP GROUP],  APPT_ORG_HIST.[SOURCE SYSTEM KEY TEXT] [TSID],  APPT_ORG_HIST.[ADJUSTED SERVICE DATE],  APPT_ORG_HIST.[EMPLOYEE STATUS TYPE DESCRIPTION],   APPT_ORG_HIST.[FINANCIAL PROFESSIONAL TENURE] [HISTORICAL FP TENURE],  APPT_ORG_HIST.[FINANCIAL PROFESSIONAL TENURE GROUP] [HISTORICAL FP TENURE GROUP],  APPT_ORG_HIST.[JOB TYPE CODE] [HISTORICAL JOB TYPE CODE],  APPT_ORG_HIST.[JOB TYPE DESCRIPTION] [HISTORICAL JOB TYPE DESCRIPTION]  FROM ENTERPRISEDATAMART.DM_01.[APPOINTMENT COMBINE FACT] APPT_FCT LEFT JOIN ENTERPRISEDATAMART.DM_01.[MEMBERSHIP TYPE DIMENSION] MBR_DIM  ON (APPT_FCT.[MEMBERSHIP TYPE DIMENSION SURROGATE KEY]=MBR_DIM.[MEMBERSHIP TYPE DIMENSION SURROGATE KEY]) LEFT JOIN ENTERPRISEDATAMART.DM_01.[APPOINTMENT DIMENSION] APPT_DIM  ON (APPT_FCT.[APPOINTMENT DIMENSION SURROGATE KEY]=APPT_DIM.[APPOINTMENT DIMENSION SURROGATE KEY]) LEFT JOIN ENTERPRISEDATAMART.DM_01.[DATE DIMENSION] DATE_DIM  ON (APPT_DIM.[APPOINTMENT DATE]=DATE_DIM.[CALENDAR DATE DATE]) LEFT JOIN ENTERPRISEDATAMART.DM_01.[ORGANIZATION DIMENSION] APPT_ORG_HIST     ON ((APPT_FCT.[APPOINTMENT ORGANIZATION DIMENSION SURROGATE KEY]=APPT_ORG_HIST.[ORGANIZATION DIMENSION SURROGATE KEY])     AND (APPT_DIM.[APPOINTMENT DATE] BETWEEN APPT_ORG_HIST.[EFFECTIVE BEGIN DATE] AND APPT_ORG_HIST.[EFFECTIVE END DATE])) LEFT JOIN ENTERPRISEDATAMART.DM_01.[SALE_HIER_DIM] SALE_HIER_DIM  ON ((SALE_HIER_DIM.EFF_BEG_DT<=APPT_DIM.[APPOINTMENT DATE])   AND (APPT_DIM.[APPOINTMENT DATE]<= DATEADD(DAY,-1,SALE_HIER_DIM.EFF_END_DT))    AND SALE_HIER_DIM.CURR_ROW_IND = 'Y'   AND APPT_ORG_HIST.[SOURCE SYSTEM KEY TEXT]=SALE_HIER_DIM.[SALE_HIER_ID])   WHERE   APPT_DIM.[CURRENT ROW INDICATOR] = 'Y'  AND APPT_DIM.[APPOINTMENT CREATE DATE OVER 14 DAYS] = 'N'  AND APPT_FCT.[PERSON DIMENSION SURROGATE KEY] <> 0  AND APPT_FCT.[APPOINTMENT STATUS NAME] <> 'DECLINED'  AND SALE_HIER_DIM.ORZN_DEPT_CDE IN ('0115','0190','0283','0291','0361','0384','0435','0525','0383')  AND APPT_ORG_HIST.[JOB TYPE CODE] IN ('001000','001001','001002','001003','001004','001005','001006','001007','001011','001505','002000', '002003', '002008', '002010', '002011', '002012', '002016', '002022', '002024', '002025', '002026', '002027', '002030', '002031', '002032', '003100', '003500')  AND APPT_DIM.[EVENT RESULT DESCRIPTION] NOT IN ('NO SHOW','CANCELLED')  AND DATE_DIM.[CALENDAR YEAR NAME] >= YEAR(GETDATE()-10)-2 AND DATE_DIM.[CALENDAR YEAR NAME] <=YEAR(GETDATE()-10)         AND APPT_ORG_HIST.[SOURCE SYSTEM KEY TEXT] NOT IN ('TS06033', 'TS13320', 'TS21623', 'TS22934', 'TS32012', 'TS34394', 'TS34662', 'TS67185')         AND APPT_DIM.[APPOINTMENT TYPE CODE] <> 'UNK'     GROUP BY  APPT_FCT.[WORKER APPOINTMENT ASSOCIATION],  APPT_FCT.[APPOINTMENT DIMENSION SURROGATE KEY],   APPT_FCT.[PERSON DIMENSION SURROGATE KEY],  MBR_DIM.[MEMBERSHIP TYPE CODE],  MBR_DIM.[MEMBERSHIP TYPE DESCRIPTION],  APPT_DIM.[APPOINTMENT DATE],  APPT_DIM.[APPOINTMENT TYPE CODE],  APPT_DIM.[APPOINTMENT TYPE DESCRIPTION],  APPT_DIM.[FIELD USER COUNT],  DATE_DIM.[CALENDAR YEAR NAME],  DATE_DIM.[CALENDAR YEAR WEEK NUMBER],  DATE_DIM.[CALENDAR WEEK END DATE],  SALE_HIER_DIM.ORZN_DEPT_CDE,  SALE_HIER_DIM.ORZN_ZONE_CDE,          SALE_HIER_DIM.ORZN_SUB_DEPT_CDE,   APPT_ORG_HIST.[SOURCE SYSTEM KEY TEXT],  APPT_ORG_HIST.[ADJUSTED SERVICE DATE],  APPT_ORG_HIST.[EMPLOYEE STATUS TYPE DESCRIPTION],  APPT_ORG_HIST.[FINANCIAL PROFESSIONAL TENURE],   APPT_ORG_HIST.[FINANCIAL PROFESSIONAL TENURE GROUP],  APPT_ORG_HIST.[DEPARTMENT IDENTIFIER],  APPT_ORG_HIST.[RFO ZONE IDENTIFIER],  APPT_ORG_HIST.[JOB TYPE CODE],  APPT_ORG_HIST.[JOB TYPE DESCRIPTION]  HAVING   SUM(APPT_FCT.[APPOINTMENT OCCURS])>0']),    #'ADDED CUSTOM' = TABLE.ADDCOLUMN(SOURCE, 'TSID_MARKET_APPT', EACH [TSID]&'-'&NUMBER.TOTEXT([APPOINTMENT DIMENSION SURROGATE KEY])),     #'CHANGED TYPE' = TABLE.TRANSFORMCOLUMNTYPES(#'ADDED CUSTOM',{{'APPOINTMENT DATE', TYPE DATE}, {'CALENDAR WEEK END DATE', TYPE DATE}, {'ADJUSTED SERVICE DATE', TYPE DATE}}),    #'REMOVED COLUMNS' = TABLE.REMOVECOLUMNS(#'CHANGED TYPE',{'PERSON DIMENSION SURROGATE KEY', 'APPT_OCCURS', 'MEMBERSHIP TYPE DESCRIPTION', 'APPOINTMENT TYPE DESCRIPTION', 'CALENDAR YEAR NAME', 'CALENDAR YEAR WEEK NUMBER', 'CALENDAR WEEK END DATE', 'RFO', 'HISTORICAL FP TENURE', 'HISTORICAL FP TENURE GROUP', 'HISTORICAL JOB TYPE DESCRIPTION'})IN    #'REMOVED COLUMNS


{'APPOINTMENT DATE': [], 'APPOINTMENT TYPE CODE': [], 'CALENDAR WEEK END DATE': [], 'APPOINTMENT DIMENSION SURROGATE KEY': [], 'JFW_IND': ['FIELD USER COUNT', 'APPOINTMENT TYPE CODE'], 'CALENDAR YEAR WEEK NUMBER': [], 'MEMBERSHIP TYPE DESCRIPTION': [], 'APPT_OCCURS': ['APPOINTMENT OCCURS'], 'CALENDAR YEAR NAME': [], 'MEMBERSHIP TYPE CODE': [], 'PERSON DIMENSION SURROGATE KEY': [], 'MARKET': [], 'TSID': ['SOURCE SYSTEM KEY TEXT'], 'ASSOCIATION]': [], 'RFO': ['ORZN_ZONE_CDE'], 'ADJUSTED SERVICE DATE': [], 'MVP GROUP': [], 'HISTORICAL JOB TYPE DESCRIPTION': ['JOB TYPE DESCRIPTION'], 'HISTORICAL FP TENURE GROUP': ['FINANCIAL PROFESSIONAL TENURE GROUP'], 'EMPLOYEE STATUS TYPE DESCRIPTION': [], 'HISTORICAL JOB TYPE CODE': ['JOB TYPE CODE'], 'HISTORICAL FP TENURE': ['FINANCIAL PROFESSIONAL TENURE'], 'APPOINTMENT TYPE DESCRIPTION': ['APPOINTMENT TYPE CODE', 'APPOINTMENT TYPE DESCRIPTION']}


35)

SELECT   A.[ORGANIZATION DIMENSION SURROGATE KEY]       ,A.[ORGANIZATION DIMENSION VERSION NUMBER]       ,A.[ORGANIZATION LEAD DIMENSION SURROGATE KEY]       ,A.[ORGANIZATION LEAD DIMENSION VERSION NUMBER]       ,A.[PACE PERFORMANCE TARGET DIMENSION SURROGATE KEY]       ,A.[PACE PERFORMANCE TARGET VERSION NUMBER]       ,A.[PROCESS DATE]    ,B.[SOURCE SYSTEM KEY TEXT] AS TSID       ,CONCAT(B.[FIRST NAME],' ',B.[LAST NAME]) AS FP_NAME       ,B.[JOB TYPE CODE]       ,CONCAT((LEFT(SALE_HIER_DIM.[ORZN_ZONE_CDE],4)),'-',SALE_HIER_DIM.ORZN_DEPT_DSCR) AS TAG    ,SALE_HIER_DIM.ORZN_ZONE_CDE [MARKET]       ,C.[SOURCE SYSTEM KEY TEXT] AS LEADER_TSID       ,CONCAT(C.[FIRST NAME],' ',C.[LAST NAME]) AS LEADER_NAME       ,CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END AS [TENURE DATA]          ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, DATEADD(MM, DATEDIFF(MM, 0, GETDATE()) + 1, -1)) AS MONTH          --,DATEDIFF(MONTH, [TENURE DATA], DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) +1, 0))) AS EOQ_MONTH    ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END) AS EOQ_MONTH    --,(DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0))) AS CURRENT_QTR    /*,CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END AS QUARTER_END*/    --,DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()), 0)) AS PREVIOUS_QTR          ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, DATEADD(YY, DATEDIFF(YY, 0, GETDATE()) + 1, -1)) AS EOY_MONTH          ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, [PROCESS DATE]) -           (DATEPART(DD,CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)*1.0-1.0)/DAY(EOMONTH(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)) +           (DATEPART(DD,[PROCESS DATE])*1.0)/DAY(EOMONTH([PROCESS DATE])) AS TENURE_MONTHS         ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END,DATEADD(YY, DATEDIFF(YY, 0, GETDATE()) + 1, -1)) - 1 +   1-1.0*(DAY(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END), -1))   + 1.0*(DAY(DATEADD(YY, DATEDIFF(YY, 0, GETDATE()) + 1, -1))-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, DATEADD(YY, DATEDIFF(YY, 0, GETDATE()) + 1, -1)), -1)) AS EOY_TENURE         ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END,CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END) - 1 +   1-1.0*(DAY(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END), -1))   + 1.0*(DAY(CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END)-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END), -1)) AS EOQ_TENURE        ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END,DATEADD(MM, DATEDIFF(MM, 0, GETDATE()) + 1, -1)) - 1 +   1-1.0*(DAY(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END), -1))   + 1.0*(DAY(DATEADD(MM, DATEDIFF(MM, 0, GETDATE()) + 1, -1))-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, DATEADD(MM, DATEDIFF(MM, 0, GETDATE()) + 1, -1)), -1)) AS EOM_TENURE       ,A.[PRODUCTION DATE]       ,A.[SNAPSHOT TYPE CODE]       ,A.[BUSINESS INTERRUPTION DAY VALUE]       ,A.[LIFE AND HEALTH GRID CREDIT AMOUNT]       ,A.[LIFE AND HEALTH PRORATED GRID CREDIT AMOUNT] AS LH_PACE_TARGET       ,A.[GRID CREDIT AMOUNT]       ,A.[PRORATED GRID CREDIT AMOUNT] AS TGR_PACE_TARGET    ,A.[NEW MONEY SALES CREDIT AMOUNT]    ,A.[PRORATED NEW MONEY SALES CREDIT AMOUNT] AS PACE_TARGET          ,D.[NEW MONEY SALES CREDIT AMOUNT] AS EOY_TARGET          ,D.[NEW MONEY SALES CREDIT RANGE AMOUNT] AS EOY_RANGE_AMT          ,E.[NEW MONEY SALES CREDIT AMOUNT] AS EOQ_TARGET          ,E.[NEW MONEY SALES CREDIT RANGE AMOUNT] AS EOQ_RANGE_AMT          ,F.[NEW MONEY SALES CREDIT AMOUNT] AS EOM_TARGET          ,F.[NEW MONEY SALES CREDIT RANGE AMOUNT] AS EOM_RANGE_AMT    ,CASE    WHEN (CASE              WHEN B.[SOURCE SYSTEM KEY TEXT] = 'TS64454' THEN 'N'              ELSE A.[PRIOR ADVISOR EXPERIENCE INDICATOR]            END) = 'Y'           OR B.[JOB TYPE CODE] = '002010' THEN ''   WHEN A.[NEW MONEY SALES CREDIT AMOUNT] > A.[PRORATED NEW MONEY SALES CREDIT AMOUNT] THEN 'ABOVE'   WHEN A.[NEW MONEY SALES CREDIT AMOUNT] < A.[PRORATED NEW MONEY SALES CREDIT AMOUNT] THEN 'BELOW'   ELSE ''     END AS ABOVE_BELOW       ,CASE WHEN (CASE              WHEN B.[SOURCE SYSTEM KEY TEXT] = 'TS64454' THEN 'N'              ELSE A.[PRIOR ADVISOR EXPERIENCE INDICATOR]            END) = 'Y'           OR B.[JOB TYPE CODE] = '002010' THEN ''          WHEN A.[GRID CREDIT AMOUNT] > A.[PRORATED GRID CREDIT AMOUNT] THEN 'ABOVE'          WHEN A.[GRID CREDIT AMOUNT] < A.[PRORATED GRID CREDIT AMOUNT] THEN 'BELOW'    ELSE ''          END AS ABOVE_BELOW_TGR       ,CASE WHEN (CASE              WHEN B.[SOURCE SYSTEM KEY TEXT] = 'TS64454' THEN 'N'              ELSE A.[PRIOR ADVISOR EXPERIENCE INDICATOR]            END) = 'Y'           OR B.[JOB TYPE CODE] = '002010' THEN ''          WHEN A.[LIFE AND HEALTH GRID CREDIT AMOUNT] > A.[LIFE AND HEALTH PRORATED GRID CREDIT AMOUNT] THEN 'ABOVE'          WHEN A.[LIFE AND HEALTH GRID CREDIT AMOUNT] < A.[LIFE AND HEALTH PRORATED GRID CREDIT AMOUNT] THEN 'BELOW'    ELSE ''          END AS ABOVE_BELOW_LH      ,CASE WHEN B.[SOURCE SYSTEM KEY TEXT] = 'TS64454' THEN 'N'       ELSE A.[PRIOR ADVISOR EXPERIENCE INDICATOR]     END AS [PRIOR ADVISOR EXPERIENCE INDICATOR]      ,CASE WHEN A.[PROCESS DATE] = MAX_PROCESS_DATE.[MAX PROCESS DATE]THEN 'Y'          ELSE 'N'          END AS CURR_WK_IND   FROM [ENTERPRISEDATAMART].[DM_01].[PACE PERFORMANCE SNAPSHOT FACT] A   INNER JOIN [ENTERPRISEDATAMART].[DM_01].[ORGANIZATION DIMENSION] B    ON (A.[ORGANIZATION DIMENSION SURROGATE KEY]=B.[ORGANIZATION DIMENSION SURROGATE KEY] AND        A.[PROCESS DATE]>=B.[EFFECTIVE BEGIN DATE] AND A.[PROCESS DATE]<=B.[EFFECTIVE END DATE])   INNER JOIN (SELECT MAX([PROCESS DATE]) [MAX PROCESS DATE] FROM [DM_01].[PACE PERFORMANCE SNAPSHOT FACT]) AS MAX_PROCESS_DATE ON 'A' = 'A'   INNER JOIN [DM_01].[DATE DIMENSION] DD ON (A.[PROCESS DATE]=DD.[CALENDAR DATE DATE])    LEFT JOIN [ENTERPRISEDATAMART].[DM_01].[SALE_HIER_DIM] SALE_HIER_DIM     ON ((     (SALE_HIER_DIM.EFF_BEG_DT<=A.[PROCESS DATE])         OR         (         (A.[PROCESS DATE]<(SELECT MIN(EFF_BEG_DT) FROM [ENTERPRISEDATAMART].[DM_01].[SALE_HIER_DIM] SUBQ WHERE B.[SOURCE SYSTEM KEY TEXT]=SUBQ.[SALE_HIER_ID] AND SUBQ.CURR_ROW_IND = 'Y'))         AND         SALE_HIER_DIM.EFF_BEG_DT=(SELECT MIN(EFF_BEG_DT) FROM [ENTERPRISEDATAMART].[DM_01].[SALE_HIER_DIM] SUBQ WHERE B.[SOURCE SYSTEM KEY TEXT]=SUBQ.[SALE_HIER_ID] AND SUBQ.CURR_ROW_IND = 'Y')         ))         AND          (A.[PROCESS DATE]<= DATEADD(DAY,-1,SALE_HIER_DIM.EFF_END_DT))         AND SALE_HIER_DIM.CURR_ROW_IND = 'Y'         AND B.[SOURCE SYSTEM KEY TEXT]=SALE_HIER_DIM.[SALE_HIER_ID])             INNER JOIN [ENTERPRISEDATAMART].[DM_01].[ORGANIZATION DIMENSION] C    ON (A.[ORGANIZATION LEAD DIMENSION SURROGATE KEY]=C.[ORGANIZATION DIMENSION SURROGATE KEY] AND     A.[PROCESS DATE]>=C.[EFFECTIVE BEGIN DATE] AND A.[PROCESS DATE]<=C.[EFFECTIVE END DATE])   LEFT JOIN [ENTERPRISEDATAMART].[DM_01].[PACE PERFORMANCE TARGET DIMENSION] D    ON (DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, DATEADD(YY, DATEDIFF(YY, 0, GETDATE()) + 1, -1))=D.[CALENDAR YEAR MONTH NUMBER])   LEFT JOIN [ENTERPRISEDATAMART].[DM_01].[PACE PERFORMANCE TARGET DIMENSION] E    ON (DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END,CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END)=E.[CALENDAR YEAR MONTH NUMBER])   LEFT JOIN [ENTERPRISEDATAMART].[DM_01].[PACE PERFORMANCE TARGET DIMENSION] F    ON (DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, DATEADD(MM, DATEDIFF(MM, 0, GETDATE()) + 1, -1))=F.[CALENDAR YEAR MONTH NUMBER])']),    #'ADDED CUSTOM' = TABLE.ADDCOLUMN(SOURCE, 'ABOVE/BELOW', EACH IF [JOB TYPE CODE] = '002010' THEN '' ELSE [ABOVE_BELOW]),    #'REMOVED COLUMNS' = TABLE.REMOVECOLUMNS(#'ADDED CUSTOM',{'ABOVE_BELOW'}),    #'REORDERED COLUMNS' = TABLE.REORDERCOLUMNS(#'REMOVED COLUMNS',{'ORGANIZATION DIMENSION SURROGATE KEY', 'ORGANIZATION DIMENSION VERSION NUMBER', 'ORGANIZATION LEAD DIMENSION SURROGATE KEY', 'ORGANIZATION LEAD DIMENSION VERSION NUMBER', 'PACE PERFORMANCE TARGET DIMENSION SURROGATE KEY', 'PACE PERFORMANCE TARGET VERSION NUMBER', 'PROCESS DATE', 'TENURE DATA', 'MONTH', 'EOQ_MONTH', 'EOY_MONTH', 'TENURE_MONTHS', 'EOY_TENURE', 'EOQ_TENURE', 'EOM_TENURE', 'PRODUCTION DATE', 'SNAPSHOT TYPE CODE', 'BUSINESS INTERRUPTION DAY VALUE', 'TSID', 'FP_NAME', 'JOB TYPE CODE', 'TAG', 'MARKET', 'LEADER_TSID', 'LEADER_NAME', 'LIFE AND HEALTH GRID CREDIT AMOUNT', 'LH_PACE_TARGET', 'GRID CREDIT AMOUNT', 'PACE_TARGET', 'EOY_TARGET', 'EOY_RANGE_AMT', 'EOQ_TARGET', 'EOQ_RANGE_AMT', 'EOM_TARGET', 'EOM_RANGE_AMT', 'ABOVE/BELOW', 'ABOVE_BELOW_LH', 'PRIOR ADVISOR EXPERIENCE INDICATOR', 'CURR_WK_IND'}),    #'RENAMED COLUMNS' = TABLE.RENAMECOLUMNS(#'REORDERED COLUMNS',{{'ABOVE/BELOW', 'ABOVE_BELOW'}}),    #'FILTERED ROWS' = TABLE.SELECTROWS(#'RENAMED COLUMNS', EACH [TENURE_MONTHS] >= 0),    #'ADDED CONDITIONAL COLUMN' = TABLE.ADDCOLUMN(#'FILTERED ROWS', 'TSL/ASSOC REP', EACH IF [JOB TYPE CODE] = '002022' THEN '002022 - TSL' ELSE IF [JOB TYPE CODE] = '002010' THEN '002010 - ASSOCIATE REP' ELSE NULL),    #'ADDED CUSTOM1' = TABLE.ADDCOLUMN(#'ADDED CONDITIONAL COLUMN', 'MVP', EACH TEXT.START([MARKET],7)),    #'MERGED QUERIES' = TABLE.NESTEDJOIN(#'ADDED CUSTOM1', {'TSID'}, #'12_31 PACE EXPORT', {'TSID'}, 'EXPORT', JOINKIND.LEFTOUTER),    #'EXPANDED EXPORT' = TABLE.EXPANDTABLECOLUMN(#'MERGED QUERIES', 'EXPORT', {'EOY TARGET', 'ABOVE/BELOW EOY'}, {'EXPORT.EOY TARGET', 'EXPORT.ABOVE/BELOW EOY'}),    #'RENAMED COLUMNS1' = TABLE.RENAMECOLUMNS(#'EXPANDED EXPORT',{{'EXPORT.EOY TARGET', 'EOY PACE TARGET'}, {'EXPORT.ABOVE/BELOW EOY', 'ABOVE/BELOW EOY'}}),    #'ADDED CUSTOM2' = TABLE.ADDCOLUMN(#'RENAMED COLUMNS1', 'JOINVALUE', EACH DATETIME.TOTEXT ([PROCESS DATE], 'MM/DD/YY') & [TSID]),    #'MERGED QUERIES2' = TABLE.NESTEDJOIN(#'ADDED CUSTOM2', {'JOINVALUE'}, OVERRIDES, {'JOIN VALUE'}, 'OVERRIDES', JOINKIND.LEFTOUTER),    #'EXPANDED OVERRIDES' = TABLE.EXPANDTABLECOLUMN(#'MERGED QUERIES2', 'OVERRIDES', {'MARKET'}, {'OVERRIDES.MARKET'}),    #'RENAMED COLUMNS2' = TABLE.RENAMECOLUMNS(#'EXPANDED OVERRIDES',{{'MARKET', 'ORIGINAL MARKET'}}),    #'ADDED CUSTOM3' = TABLE.ADDCOLUMN(#'RENAMED COLUMNS2', 'MARKET', EACH IF [OVERRIDES.MARKET] IS NULL THEN [ORIGINAL MARKET] ELSE [OVERRIDES.MARKET]),    #'MERGED QUERIES3' = TABLE.NESTEDJOIN(#'ADDED CUSTOM3', {'MARKET'}, #'DIRECTOR LIST', {'WORKER_STS_FCT_MKT'}, 'DIRECTOR LIST', JOINKIND.LEFTOUTER),    #'EXPANDED DIRECTOR LIST' = TABLE.EXPANDTABLECOLUMN(#'MERGED QUERIES3', 'DIRECTOR LIST', {'SRC_SYS_KEY_TXT', 'EMP_NM', 'EFF_BEG_DT'}, {'DIRECTOR LIST.SRC_SYS_KEY_TXT', 'DIRECTOR LIST.EMP_NM', 'DIRECTOR LIST.EFF_BEG_DT'}),    #'RENAMED COLUMNS3' = TABLE.RENAMECOLUMNS(#'EXPANDED DIRECTOR LIST',{{'DIRECTOR LIST.EMP_NM', 'MARKET DIRECTOR'}, {'DIRECTOR LIST.SRC_SYS_KEY_TXT', 'DIRECTOR TSID'},{'DIRECTOR LIST.EFF_BEG_DT', 'MARKET DIRECTOR START DATE'}}),    #'CHANGED TYPE' = TABLE.TRANSFORMCOLUMNTYPES(#'RENAMED COLUMNS3',{{'PROCESS DATE', TYPE DATE}}),    #'ADDED CUSTOM7' = TABLE.ADDCOLUMN(#'CHANGED TYPE', 'JOINVALUE2', EACH [TSID]&'-'&TEXT.UPPER(DATE.TOTEXT([PROCESS DATE],'DDMMMYYYY'))),    #'MERGED QUERIES4' = TABLE.NESTEDJOIN(#'ADDED CUSTOM7', {'JOINVALUE2'}, #'MARKET DEVELOPERS (2)', {'JOINVALUE'}, 'MARKET DEVELOPERS', JOINKIND.LEFTOUTER),    #'EXPANDED MARKET DEVELOPERS' = TABLE.EXPANDTABLECOLUMN(#'MERGED QUERIES4', 'MARKET DEVELOPERS', {'MARKET DEVELOPER START DATE', 'RDL NAME'}, {'MARKET DEVELOPERS.MARKET DEVELOPER START DATE', 'MARKET DEVELOPERS.RDL NAME'}),    #'ADDED CUSTOM4' = TABLE.ADDCOLUMN(#'EXPANDED MARKET DEVELOPERS', 'MARKET DIRECTOR CONDITIONAL', EACH IF [MARKET DIRECTOR START DATE] IS NULL THEN [MARKET DIRECTOR]ELSE IF [PROCESS DATE] < [MARKET DIRECTOR START DATE] THEN NULL ELSE [MARKET DIRECTOR]),    #'ADDED CUSTOM5' = TABLE.ADDCOLUMN(#'ADDED CUSTOM4', 'DIRECTOR TSID CONDITIONAL', EACH IF [MARKET DIRECTOR START DATE] IS NULL THEN [DIRECTOR TSID]ELSE IF [PROCESS DATE] < [MARKET DIRECTOR START DATE] THEN NULL ELSE [DIRECTOR TSID]),    #'REMOVED COLUMNS1' = TABLE.REMOVECOLUMNS(#'ADDED CUSTOM5',{'DIRECTOR TSID', 'MARKET DIRECTOR'}),    #'RENAMED COLUMNS4' = TABLE.RENAMECOLUMNS(#'REMOVED COLUMNS1',{{'MARKET DIRECTOR CONDITIONAL', 'MARKET DIRECTOR'}, {'DIRECTOR TSID CONDITIONAL', 'DIRECTOR TSID'}, {'MARKET DEVELOPERS.MARKET DEVELOPER START DATE', 'DEVELOPER BEGIN DATE'}}),    #'ADDED CUSTOM6' = TABLE.ADDCOLUMN(#'RENAMED COLUMNS4', 'MARKET DEVELOPERS.RDL NAME CONDITIONAL', EACH IF [DEVELOPER BEGIN DATE] IS NULL THEN [MARKET DEVELOPERS.RDL NAME]ELSE IF [PROCESS DATE] < [DEVELOPER BEGIN DATE] THEN NULL ELSE [MARKET DEVELOPERS.RDL NAME]),    #'REMOVED COLUMNS2' = TABLE.REMOVECOLUMNS(#'ADDED CUSTOM6',{'MARKET DEVELOPERS.RDL NAME'}),    #'RENAMED COLUMNS5' = TABLE.RENAMECOLUMNS(#'REMOVED COLUMNS2',{{'MARKET DEVELOPERS.RDL NAME CONDITIONAL', 'MARKET DEVELOPERS.RDL NAME'}})IN    #'RENAMED COLUMNS5	




Source Tables: ['ENTERPRISEDATAMART.DM_01', 'DM_01', 'ENTERPRISEDATAMART.DM_01.SALE_HIER_DIM']
{'EOQ_MONTH': ['TENURE DATA'], 'ABOVE_BELOW_TGR': ['SOURCE SYSTEM KEY TEXT', 'PRIOR ADVISOR EXPERIENCE INDICATOR', 'JOB TYPE CODE', ' WHEN A.GRID CREDIT AMOUNT', 'PRORATED GRID CREDIT AMOUNT', 'GRID CREDIT AMOUNT'], 'CURR_WK_IND': ['PROCESS DATE', 'MAX PROCESS DATE'], 'EOM_RANGE_AMT': ['NEW MONEY SALES CREDIT RANGE AMOUNT'], 'ABOVE_BELOW': ['SOURCE SYSTEM KEY TEXT', 'PRIOR ADVISOR EXPERIENCE INDICATOR', 'JOB TYPE CODE', ' WHEN A.NEW MONEY SALES CREDIT AMOUNT', 'PRORATED NEW MONEY SALES CREDIT AMOUNT', 'NEW MONEY SALES CREDIT AMOUNT'], 'CURRENT_QTR': ['DATEADD', 'DD', 'QQ', 'DATEDIFF', 'GETDATE'], 'EOQ_TARGET': ['NEW MONEY SALES CREDIT AMOUNT'], 'PRIOR ADVISOR EXPERIENCE INDICATOR': ['SOURCE SYSTEM KEY TEXT', 'PRIOR ADVISOR EXPERIENCE INDICATOR'], 'EOY_RANGE_AMT': ['NEW MONEY SALES CREDIT RANGE AMOUNT'], 'PROCESS DATE': [], 'PACE PERFORMANCE TARGET VERSION NUMBER': [], 'PACE PERFORMANCE TARGET DIMENSION SURROGATE KEY': [], 'LEADER_TSID': ['SOURCE SYSTEM KEY TEXT'], 'EOQ_TENURE': ['SOURCE SYSTEM KEY TEXT', 'ADJUSTED SERVICE DATE', 'TENURE DATA'], 'TENURE DATA': ['SOURCE SYSTEM KEY TEXT', 'ADJUSTED SERVICE DATE', 'TENURE DATA'], 'ORGANIZATION LEAD DIMENSION VERSION NUMBER': [], 'PRODUCTION DATE': [], 'FP_NAME': ['FIRST NAME', 'LAST NAME'], 'TAG': ['ORZN_ZONE_CDE'], 'SNAPSHOT TYPE CODE': [], 'BUSINESS INTERRUPTION DAY VALUE': [], 'LEADER_NAME': ['FIRST NAME', 'LAST NAME'], 'GRID CREDIT AMOUNT': [], 'EOM_TARGET': ['NEW MONEY SALES CREDIT AMOUNT'], 'ORGANIZATION DIMENSION SURROGATE KEY': [], 'TENURE_MONTHS': ['SOURCE SYSTEM KEY TEXT', 'ADJUSTED SERVICE DATE', 'TENURE DATA', 'PROCESS DATE'], 'PACE_TARGET': ['PRORATED NEW MONEY SALES CREDIT AMOUNT'], 'QUARTER_END': ['GETDATE', 'DATEFROMPARTS', 'YEAR', 'DATEADD', 'DD', 'QQ', 'DATEDIFF', 'ELSE'], 'NEW MONEY SALES CREDIT AMOUNT': [], 'ORGANIZATION DIMENSION VERSION NUMBER': [], 'EOY_TARGET': ['NEW MONEY SALES CREDIT AMOUNT'], 'TGR_PACE_TARGET': ['PRORATED GRID CREDIT AMOUNT'], 'TSID': ['SOURCE SYSTEM KEY TEXT'], 'EOY_MONTH': ['SOURCE SYSTEM KEY TEXT', 'ADJUSTED SERVICE DATE', 'TENURE DATA'], 'ABOVE_BELOW_LH': ['SOURCE SYSTEM KEY TEXT', 'PRIOR ADVISOR EXPERIENCE INDICATOR', 'JOB TYPE CODE', ' WHEN A.LIFE AND HEALTH GRID CREDIT AMOUNT', 'LIFE AND HEALTH PRORATED GRID CREDIT AMOUNT', 'LIFE AND HEALTH GRID CREDIT AMOUNT'], 'EOQ_RANGE_AMT': ['NEW MONEY SALES CREDIT RANGE AMOUNT'], 'LH_PACE_TARGET': ['LIFE AND HEALTH PRORATED GRID CREDIT AMOUNT'], 'EOY_TENURE': ['SOURCE SYSTEM KEY TEXT', 'ADJUSTED SERVICE DATE', 'TENURE DATA'], 'MONTH': ['SOURCE SYSTEM KEY TEXT', 'ADJUSTED SERVICE DATE', 'TENURE DATA'], 'JOB TYPE CODE': [], 'MARKET': [], 'EOM_TENURE': ['SOURCE SYSTEM KEY TEXT', 'ADJUSTED SERVICE DATE', 'TENURE DATA'], 'PREVIOUS_QTR': ['DATEADD', 'DD', 'QQ', 'DATEDIFF', 'GETDATE'], 'LIFE AND HEALTH GRID CREDIT AMOUNT': [], 'ORGANIZATION LEAD DIMENSION SURROGATE KEY': []}        



33)

SELECT PACE_QUERY.[ORGANIZATION DIMENSION SURROGATE KEY], PACE_QUERY.[ORGANIZATION DIMENSION VERSION NUMBER], PACE_QUERY.[ORGANIZATION LEAD DIMENSION SURROGATE KEY], PACE_QUERY.[ORGANIZATION LEAD DIMENSION VERSION NUMBER], PACE_QUERY.[PACE PERFORMANCE TARGET DIMENSION SURROGATE KEY], PACE_QUERY.[PACE PERFORMANCE TARGET VERSION NUMBER], PACE_QUERY.[PROCESS DATE], PACE_QUERY.[TENURE DATA], PACE_QUERY.[MONTH], PACE_QUERY.[EOQ_MONTH], PACE_QUERY.[EOY_MONTH], PACE_QUERY.[TENURE_MONTHS], PACE_QUERY.[EOY_TENURE], PACE_QUERY.[EOQ_TENURE], PACE_QUERY.[EOM_TENURE], PACE_QUERY.[PRODUCTION DATE], PACE_QUERY.[SNAPSHOT TYPE CODE], PACE_QUERY.[BUSINESS INTERRUPTION DAY VALUE], PACE_QUERY.[TSID], PACE_QUERY.[FP_NAME], PACE_QUERY.[JOB TYPE CODE], PACE_QUERY.[TAG], PACE_QUERY.[MARKET], PACE_QUERY.[LEADER_TSID], PACE_QUERY.[LEADER_NAME], PACE_QUERY.[LIFE AND HEALTH GRID CREDIT AMOUNT], PACE_QUERY.[LH_PACE_TARGET], PACE_QUERY.[GRID CREDIT AMOUNT], PACE_QUERY.[PACE_TARGET], PACE_QUERY.[EOY_TARGET], PACE_QUERY.[EOY_RANGE_AMT], PACE_QUERY.[EOQ_TARGET], PACE_QUERY.[EOQ_RANGE_AMT], PACE_QUERY.[EOM_TARGET], PACE_QUERY.[EOM_RANGE_AMT], (CASE WHEN CBU_QUERY.[TSID] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN CBU_QUERY.[NEW_ABOVE_BELOW] ELSE PACE_QUERY.[ABOVE_BELOW] END) AS ABOVE_BELOW, PACE_QUERY.[ABOVE_BELOW_LH], PACE_QUERY.[PRIOR ADVISOR EXPERIENCE INDICATOR], PACE_QUERY.[CURR_WK_IND] FROM ( SELECT   A.[ORGANIZATION DIMENSION SURROGATE KEY]       ,A.[ORGANIZATION DIMENSION VERSION NUMBER]       ,A.[ORGANIZATION LEAD DIMENSION SURROGATE KEY]       ,A.[ORGANIZATION LEAD DIMENSION VERSION NUMBER]       ,A.[PACE PERFORMANCE TARGET DIMENSION SURROGATE KEY]       ,A.[PACE PERFORMANCE TARGET VERSION NUMBER]       ,A.[PROCESS DATE]       ,CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END AS [TENURE DATA]          ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, DATEADD(MM, DATEDIFF(MM, 0, GETDATE()) + 1, -1)) AS MONTH          --,DATEDIFF(MONTH, [TENURE DATA], DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) +1, 0))) AS EOQ_MONTH    ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END) AS EOQ_MONTH    --,(DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0))) AS CURRENT_QTR    /*,CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END AS QUARTER_END*/    --,DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()), 0)) AS PREVIOUS_QTR          ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, DATEADD(YY, DATEDIFF(YY, 0, GETDATE()) + 1, -1)) AS EOY_MONTH          ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, [PROCESS DATE]) -           (DATEPART(DD,CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)*1.0-1.0)/DAY(EOMONTH(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)) +           (DATEPART(DD,[PROCESS DATE])*1.0)/DAY(EOMONTH([PROCESS DATE])) AS TENURE_MONTHS         ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END,DATEADD(YY, DATEDIFF(YY, 0, GETDATE()) + 1, -1)) - 1 +   1-1.0*(DAY(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END), -1))   + 1.0*(DAY(DATEADD(YY, DATEDIFF(YY, 0, GETDATE()) + 1, -1))-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, DATEADD(YY, DATEDIFF(YY, 0, GETDATE()) + 1, -1)), -1)) AS EOY_TENURE         ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END,CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END) - 1 +   1-1.0*(DAY(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END), -1))   + 1.0*(DAY(CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END)-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END), -1)) AS EOQ_TENURE        ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END,DATEADD(MM, DATEDIFF(MM, 0, GETDATE()) + 1, -1)) - 1 +   1-1.0*(DAY(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END), -1))   + 1.0*(DAY(DATEADD(MM, DATEDIFF(MM, 0, GETDATE()) + 1, -1))-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, DATEADD(MM, DATEDIFF(MM, 0, GETDATE()) + 1, -1)), -1)) AS EOM_TENURE       ,A.[PRODUCTION DATE]       ,A.[SNAPSHOT TYPE CODE]       ,A.[BUSINESS INTERRUPTION DAY VALUE]          ,B.[SOURCE SYSTEM KEY TEXT] AS TSID          ,CONCAT(B.[FIRST NAME],' ',B.[LAST NAME]) AS FP_NAME          ,B.[JOB TYPE CODE]          ,CONCAT(SALE_HIER_DIM.[ORZN_DEPT_CDE],'-',SALE_HIER_DIM.[ORZN_DEPT_DSCR]) AS TAG          ,SALE_HIER_DIM.[ORZN_ZONE_CDE] AS MARKET          ,C.[SOURCE SYSTEM KEY TEXT] AS LEADER_TSID          ,CONCAT(C.[FIRST NAME],' ',C.[LAST NAME]) AS LEADER_NAME       ,A.[LIFE AND HEALTH GRID CREDIT AMOUNT]       ,A.[LIFE AND HEALTH PRORATED GRID CREDIT AMOUNT] AS LH_PACE_TARGET       ,A.[NEW MONEY SALES CREDIT AMOUNT] AS [GRID CREDIT AMOUNT]       ,A.[PRORATED NEW MONEY SALES CREDIT AMOUNT] AS PACE_TARGET          ,D.[GRID CREDIT AMOUNT] AS EOY_TARGET          ,D.[GRID CREDIT RANGE AMOUNT] AS EOY_RANGE_AMT          ,E.[GRID CREDIT AMOUNT] AS EOQ_TARGET          ,E.[GRID CREDIT RANGE AMOUNT] AS EOQ_RANGE_AMT          ,F.[GRID CREDIT AMOUNT] AS EOM_TARGET          ,F.[GRID CREDIT RANGE AMOUNT] AS EOM_RANGE_AMT          ,CASE    WHEN (CASE              WHEN B.[SOURCE SYSTEM KEY TEXT] = 'TS64454' THEN 'N'              ELSE A.[PRIOR ADVISOR EXPERIENCE INDICATOR]            END) = 'Y'           OR B.[JOB TYPE CODE] = '002010' THEN ''   WHEN A.[NEW MONEY SALES CREDIT AMOUNT] > A.[PRORATED NEW MONEY SALES CREDIT AMOUNT] THEN 'ABOVE'   WHEN A.[NEW MONEY SALES CREDIT AMOUNT] < A.[PRORATED NEW MONEY SALES CREDIT AMOUNT] THEN 'BELOW'   ELSE ''     END AS ABOVE_BELOW          ,CASE WHEN [PRIOR ADVISOR EXPERIENCE INDICATOR] = 'Y' OR [LIFE AND HEALTH PRORATED GRID CREDIT AMOUNT] = 0 THEN ''          WHEN A.[LIFE AND HEALTH GRID CREDIT AMOUNT] > A.[LIFE AND HEALTH PRORATED GRID CREDIT AMOUNT] THEN 'ABOVE'          ELSE 'BELOW'          END AS ABOVE_BELOW_LH      ,[PRIOR ADVISOR EXPERIENCE INDICATOR]        ,CASE WHEN A.[PROCESS DATE] = MAX_PROCESS_DATE.[MAX PROCESS DATE]THEN 'Y'          ELSE 'N'          END AS CURR_WK_IND   FROM [ENTERPRISEDATAMART].[DM_01].[PACE PERFORMANCE SNAPSHOT FACT] A   INNER JOIN [ENTERPRISEDATAMART].[DM_01].[ORGANIZATION DIMENSION] B    ON (A.[ORGANIZATION DIMENSION SURROGATE KEY]=B.[ORGANIZATION DIMENSION SURROGATE KEY] AND        (A.[PROCESS DATE]<=B.[EFFECTIVE END DATE] AND  A.[PROCESS DATE]>=B.[EFFECTIVE BEGIN DATE])     )   INNER JOIN (SELECT MAX([PROCESS DATE]) [MAX PROCESS DATE] FROM [ENTERPRISEDATAMART].[DM_01].[PACE PERFORMANCE SNAPSHOT FACT]) AS MAX_PROCESS_DATE ON 'A' = 'A'   INNER JOIN [ENTERPRISEDATAMART].[DM_01].[DATE DIMENSION] DD ON (A.[PROCESS DATE]=DD.[CALENDAR DATE DATE])          LEFT JOIN [ENTERPRISEDATAMART].[DM_01].[SALE_HIER_DIM] SALE_HIER_DIM     ON ((     (SALE_HIER_DIM.EFF_BEG_DT<=A.[PROCESS DATE])         OR         (         (A.[PROCESS DATE]<(SELECT MIN(EFF_BEG_DT) FROM [ENTERPRISEDATAMART].[DM_01].[SALE_HIER_DIM] SUBQ WHERE B.[SOURCE SYSTEM KEY TEXT]=SUBQ.[SALE_HIER_ID] AND SUBQ.CURR_ROW_IND = 'Y'))         AND         SALE_HIER_DIM.EFF_BEG_DT=(SELECT MIN(EFF_BEG_DT) FROM [ENTERPRISEDATAMART].[DM_01].[SALE_HIER_DIM] SUBQ WHERE B.[SOURCE SYSTEM KEY TEXT]=SUBQ.[SALE_HIER_ID] AND SUBQ.CURR_ROW_IND = 'Y')         ))         AND          (A.[PROCESS DATE]<= DATEADD(DAY,-1,SALE_HIER_DIM.EFF_END_DT))         AND SALE_HIER_DIM.CURR_ROW_IND = 'Y'         AND B.[SOURCE SYSTEM KEY TEXT]=SALE_HIER_DIM.[SALE_HIER_ID])            INNER JOIN [ENTERPRISEDATAMART].[DM_01].[ORGANIZATION DIMENSION] C    ON (A.[ORGANIZATION LEAD DIMENSION SURROGATE KEY]=C.[ORGANIZATION DIMENSION SURROGATE KEY] AND     (A.[PROCESS DATE]<=C.[EFFECTIVE END DATE] AND  A.[PROCESS DATE]>=C.[EFFECTIVE BEGIN DATE]))   LEFT JOIN [ENTERPRISEDATAMART].[DM_01].[PACE PERFORMANCE TARGET DIMENSION] D    ON (DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, DATEADD(YY, DATEDIFF(YY, 0, GETDATE()) + 1, -1))=D.[CALENDAR YEAR MONTH NUMBER])   LEFT JOIN [ENTERPRISEDATAMART].[DM_01].[PACE PERFORMANCE TARGET DIMENSION] E    ON (DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END,CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END)=E.[CALENDAR YEAR MONTH NUMBER])   LEFT JOIN [ENTERPRISEDATAMART].[DM_01].[PACE PERFORMANCE TARGET DIMENSION] F    ON (DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, DATEADD(MM, DATEDIFF(MM, 0, GETDATE()) + 1, -1))=F.[CALENDAR YEAR MONTH NUMBER])    ) PACE_QUERY    LEFT JOIN    ( SELECT  A.[PROCESS DATE], B.[SOURCE SYSTEM KEY TEXT] AS TSID, ROUND(DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, [PROCESS DATE]) -           (DATEPART(DD,CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)*1.0-1.0)/DAY(EOMONTH(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)) +           (DATEPART(DD,[PROCESS DATE])*1.0)/DAY(EOMONTH([PROCESS DATE])),0,1) AS TENURE_TRUNC, DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, [PROCESS DATE]) -           (DATEPART(DD,CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)*1.0-1.0)/DAY(EOMONTH(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)) +           (DATEPART(DD,[PROCESS DATE])*1.0)/DAY(EOMONTH([PROCESS DATE])) AS TENURE_MONTHS, PTD_BEF.[GRID CREDIT AMOUNT], ((PTD_BEF.[GRID CREDIT RANGE AMOUNT]-PTD_BEF.[GRID CREDIT AMOUNT])* (DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, [PROCESS DATE]) -           (DATEPART(DD,CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)*1.0-1.0)/DAY(EOMONTH(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)) +           (DATEPART(DD,[PROCESS DATE])*1.0)/DAY(EOMONTH([PROCESS DATE]))-ROUND(DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, [PROCESS DATE]) -           (DATEPART(DD,CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)*1.0-1.0)/DAY(EOMONTH(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)) +           (DATEPART(DD,[PROCESS DATE])*1.0)/DAY(EOMONTH([PROCESS DATE])),0,1))+PTD_BEF.[GRID CREDIT AMOUNT]) AS PACE_TARGET, CASE WHEN [PRIOR ADVISOR EXPERIENCE INDICATOR] = 'Y' THEN '' WHEN ( DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, [PROCESS DATE]) -           (DATEPART(DD,CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)*1.0-1.0)/DAY(EOMONTH(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)) +           (DATEPART(DD,[PROCESS DATE])*1.0)/DAY(EOMONTH([PROCESS DATE])) )<4 THEN '' WHEN  ((PTD_BEF.[GRID CREDIT RANGE AMOUNT]-PTD_BEF.[GRID CREDIT AMOUNT])* (DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, [PROCESS DATE]) -           (DATEPART(DD,CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)*1.0-1.0)/DAY(EOMONTH(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)) +           (DATEPART(DD,[PROCESS DATE])*1.0)/DAY(EOMONTH([PROCESS DATE]))-ROUND(DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, [PROCESS DATE]) -           (DATEPART(DD,CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)*1.0-1.0)/DAY(EOMONTH(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)) +           (DATEPART(DD,[PROCESS DATE])*1.0)/DAY(EOMONTH([PROCESS DATE])),0,1))+PTD_BEF.[GRID CREDIT AMOUNT])    <=A.[GRID CREDIT AMOUNT] THEN 'ABOVE' ELSE 'BELOW' END AS NEW_ABOVE_BELOW FROM [ENTERPRISEDATAMART].[DM_01].[PACE PERFORMANCE SNAPSHOT FACT] A   INNER JOIN [ENTERPRISEDATAMART].[DM_01].[ORGANIZATION DIMENSION] B    ON (A.[ORGANIZATION DIMENSION SURROGATE KEY]=B.[ORGANIZATION DIMENSION SURROGATE KEY] AND        B.[CURRENT ROW INDICATOR] = 'Y') LEFT JOIN (SELECT * FROM [ENTERPRISEDATAMART].[DM_01].[PACE PERFORMANCE TARGET DIMENSION]) PTD_BEF ON ROUND(DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, [PROCESS DATE]) -           (DATEPART(DD,CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)*1.0-1.0)/DAY(EOMONTH(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)) +           (DATEPART(DD,[PROCESS DATE])*1.0)/DAY(EOMONTH([PROCESS DATE])),0,1)=PTD_BEF.[CALENDAR YEAR MONTH NUMBER] LEFT JOIN (SELECT * FROM [ENTERPRISEDATAMART].[DM_01].[PACE PERFORMANCE TARGET DIMENSION]) PTD_AFT ON (ROUND(DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, [PROCESS DATE]) -           (DATEPART(DD,CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)*1.0-1.0)/DAY(EOMONTH(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)) +           (DATEPART(DD,[PROCESS DATE])*1.0)/DAY(EOMONTH([PROCESS DATE])),0,1)+1)=PTD_AFT.[CALENDAR YEAR MONTH NUMBER]    WHERE B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642','TS78250','TS75194')    ) CBU_QUERY    ON (PACE_QUERY.[PROCESS DATE]=CBU_QUERY.[PROCESS DATE] AND PACE_QUERY.[TSID]=CBU_QUERY.[TSID])    ']),    #'ADDED CUSTOM' = TABLE.ADDCOLUMN(SOURCE, 'ABOVE/BELOW', EACH IF [JOB TYPE CODE] = '002010' THEN '' ELSE [ABOVE_BELOW]),    #'REMOVED COLUMNS' = TABLE.REMOVECOLUMNS(#'ADDED CUSTOM',{'ABOVE_BELOW'}),    #'REORDERED COLUMNS' = TABLE.REORDERCOLUMNS(#'REMOVED COLUMNS',{'ORGANIZATION DIMENSION SURROGATE KEY', 'ORGANIZATION DIMENSION VERSION NUMBER', 'ORGANIZATION LEAD DIMENSION SURROGATE KEY', 'ORGANIZATION LEAD DIMENSION VERSION NUMBER', 'PACE PERFORMANCE TARGET DIMENSION SURROGATE KEY', 'PACE PERFORMANCE TARGET VERSION NUMBER', 'PROCESS DATE', 'TENURE DATA', 'MONTH', 'EOQ_MONTH', 'EOY_MONTH', 'TENURE_MONTHS', 'EOY_TENURE', 'EOQ_TENURE', 'EOM_TENURE', 'PRODUCTION DATE', 'SNAPSHOT TYPE CODE', 'BUSINESS INTERRUPTION DAY VALUE', 'TSID', 'FP_NAME', 'JOB TYPE CODE', 'TAG', 'MARKET', 'LEADER_TSID', 'LEADER_NAME', 'LIFE AND HEALTH GRID CREDIT AMOUNT', 'LH_PACE_TARGET', 'GRID CREDIT AMOUNT', 'PACE_TARGET', 'EOY_TARGET', 'EOY_RANGE_AMT', 'EOQ_TARGET', 'EOQ_RANGE_AMT', 'EOM_TARGET', 'EOM_RANGE_AMT', 'ABOVE/BELOW', 'ABOVE_BELOW_LH', 'PRIOR ADVISOR EXPERIENCE INDICATOR', 'CURR_WK_IND'}),    #'RENAMED COLUMNS' = TABLE.RENAMECOLUMNS(#'REORDERED COLUMNS',{{'ABOVE/BELOW', 'ABOVE_BELOW'}}),    #'MERGED QUERIES' = TABLE.NESTEDJOIN(#'RENAMED COLUMNS', {'PROCESS DATE'}, #'WEEK START', {'WEEK_START_DATE'}, 'WEEK START', JOINKIND.LEFTOUTER),    #'EXPANDED WEEK START' = TABLE.EXPANDTABLECOLUMN(#'MERGED QUERIES', 'WEEK START', {'WEEK_START_DATE'}, {'WEEK START.WEEK_START_DATE'}),    #'FILTERED ROWS3' = TABLE.SELECTROWS(#'EXPANDED WEEK START', EACH ([WEEK START.WEEK_START_DATE] <> NULL)),    #'FILTERED ROWS' = TABLE.SELECTROWS(#'FILTERED ROWS3', EACH [TENURE_MONTHS] >= 0),    #'ADDED CUSTOM1' = TABLE.ADDCOLUMN(#'FILTERED ROWS', 'JOINVALUE', EACH DATETIME.TOTEXT ([WEEK START.WEEK_START_DATE], 'MM/DD/YY') & [TSID]),    #'MERGED QUERIES1' = TABLE.NESTEDJOIN(#'ADDED CUSTOM1', {'JOINVALUE'}, OVERRIDES, {'JOIN VALUE'}, 'OVERRIDES', JOINKIND.LEFTOUTER),    #'EXPANDED OVERRIDES' = TABLE.EXPANDTABLECOLUMN(#'MERGED QUERIES1', 'OVERRIDES', {'MARKET'}, {'OVERRIDES.MARKET'}),    #'RENAMED COLUMNS1' = TABLE.RENAMECOLUMNS(#'EXPANDED OVERRIDES',{{'MARKET', 'ORIGINAL MARKET'}}),    #'ADDED CUSTOM2' = TABLE.ADDCOLUMN(#'RENAMED COLUMNS1', 'MARKET', EACH IF [OVERRIDES.MARKET] IS NULL THEN [ORIGINAL MARKET] ELSE [OVERRIDES.MARKET]),    #'FILTERED ROWS1' = TABLE.SELECTROWS(#'ADDED CUSTOM2', EACH ([JOB TYPE CODE] <> '002003' AND [JOB TYPE CODE] <> '002009' AND [JOB TYPE CODE] <> '002022') AND ([PACE_TARGET] <> 0))IN    #'FILTERED ROWS1	


Source Tables: ['ENTERPRISEDATAMART.DM_01.SALE_HIER_DIM', 'ENTERPRISEDATAMART.DM_01']
{'JOB TYPE CODE': [], 'TENURE DATA': [], 'EOY_TARGET': [], 'PRIOR ADVISOR EXPERIENCE INDICATOR': [], 'LH_PACE_TARGET': [], 'BUSINESS INTERRUPTION DAY VALUE': [], 'TSID': [], 'EOQ_RANGE_AMT': [], 'LIFE AND HEALTH GRID CREDIT AMOUNT': [], 'ORGANIZATION LEAD DIMENSION VERSION NUMBER': [], 'MARKET': [], 'EOQ_TARGET': [], 'MONTH': [], 'PACE PERFORMANCE TARGET DIMENSION SURROGATE KEY': [], 'EOY_RANGE_AMT': [], 'ORGANIZATION DIMENSION SURROGATE KEY': [], 'GRID CREDIT AMOUNT': [], 'PROCESS DATE': [], 'ORGANIZATION DIMENSION VERSION NUMBER': [], 'PACE_TARGET': [], 'EOM_TARGET': [], 'TENURE_MONTHS': [], 'EOQ_TENURE': [], 'EOY_TENURE': [], 'PACE PERFORMANCE TARGET VERSION NUMBER': [], 'CURR_WK_IND': [], 'SNAPSHOT TYPE CODE': [], 'EOM_TENURE': [], 'EOM_RANGE_AMT': [], 'ABOVE_BELOW': ['TSID', 'NEW_ABOVE_BELOW', 'ABOVE_BELOW'], 'FP_NAME': [], 'ABOVE_BELOW_LH': [], 'TAG': [], 'EOQ_MONTH': [], 'EOY_MONTH': [], 'LEADER_TSID': [], 'PRODUCTION DATE': [], 'ORGANIZATION LEAD DIMENSION SURROGATE KEY': [], 'LEADER_NAME': []}





30)

SELECT TASK_FCT.[TASK DIMENSION SURROGATE KEY],        TASK_FCT.[PERSON DIMENSION SURROGATE KEY],        TASK_DIM.[TASK DATE],        SUM(TASK_FCT.[TASK OCCURS]) [TASK_OCCURS],        TASK_FCT.[PERSON OCCURS],         TASK_DIM.[TASK TYPE NAME],        TASK_DIM.[TASK STATUS NAME],        DATE_DIM.[CALENDAR YEAR NAME] AS ''PERFORMANCE YEAR NAME'',        DATE_DIM.[CALENDAR YEAR WEEK NUMBER] AS ''PERFORMANCE YEAR WEEK NUMBER'',        ORG_DIM.[SOURCE SYSTEM KEY TEXT] AS TSID,        --SALE_HIER_DIM.ORZN_DEPT_CDE,        --SALE_HIER_DIM.ORZN_ZONE_CDE,        ORG_DIM.[FIRST NAME] + ' ' + ORG_DIM.[LAST NAME] AS NAME         --ORG_DIM.[JOB TYPE CODE] AS JOB_TYP_CDE,        --ORG_DIM.[ADJUSTED SERVICE DATE] AS ADJ_SVC_DT,        --ORG_DIM.[EMPLOYEE STATUS TYPE CODE] AS EMP_STS_TYP_CDE   FROM ENTERPRISEDATAMART.[DM_01].[TASK FACT] TASK_FCT LEFT JOIN        ENTERPRISEDATAMART.[DM_01].[TASK DIMENSION] TASK_DIM     ON TASK_FCT.[TASK DIMENSION SURROGATE KEY] = TASK_DIM.[TASK DIMENSION SURROGATE KEY] LEFT JOIN        ENTERPRISEDATAMART.DM_01.[DATE DIMENSION] DATE_DIM     ON TASK_DIM.[TASK DATE]=DATE_DIM.[CALENDAR DATE DATE] LEFT JOIN         ENTERPRISEDATAMART.DM_01.[ORGANIZATION DIMENSION] ORG_DIM     ON ((TASK_FCT.[TASK ORGANIZATION DIMENSION SURROGATE KEY] = ORG_DIM.[ORGANIZATION DIMENSION SURROGATE KEY]) AND     (TASK_DIM.[TASK DATE] BETWEEN ORG_DIM.[EFFECTIVE BEGIN DATE] AND ORG_DIM.[EFFECTIVE END DATE])) LEFT JOIN         ENTERPRISEDATAMART.DM_01.[SALE_HIER_DIM] SALE_HIER_DIM    ON ((SALE_HIER_DIM.EFF_BEG_DT <= TASK_DIM.[TASK DATE]) AND        (TASK_DIM.[TASK DATE] <= DATEADD(DAY,-1,SALE_HIER_DIM.EFF_END_DT)) AND          SALE_HIER_DIM.CURR_ROW_IND = 'Y' AND          ORG_DIM.[SOURCE SYSTEM KEY TEXT]=SALE_HIER_DIM.[SALE_HIER_ID])   WHERE TASK_DIM.[TASK TYPE NAME] IN ('APPROACH  CALL','APPROACH CALL')    AND TASK_DIM.[TASK STATUS NAME] IN ('COMPLETED', 'AUTO COMPLETED', 'IN PROGRESS')     AND TASK_FCT.[PERSON DIMENSION SURROGATE KEY] <> 0    AND SALE_HIER_DIM.ORZN_DEPT_CDE IN ('0115','0165','0190','0240','0283','0291','0361','0365','0384','0410','0435','0475','0496','0525','0529','0810')    AND (ORG_DIM.[JOB TYPE CODE] IN ('002000', '002003', '002008', '002010', '002011', '002012', '002016', '002022', '002025', '002026', '002027', '002030', '002032', '003100', '003500')     OR ORG_DIM.[DEPARTMENT IDENTIFIER] IN ('5405','5407','5408','5409','1701','1702','1703','0383'))       AND DATE_DIM.[PERFORMANCE YEAR NAME] IN ('2022','2023')      GROUP BY    TASK_FCT.[TASK DIMENSION SURROGATE KEY],    TASK_FCT.[PERSON DIMENSION SURROGATE KEY],    TASK_DIM.[TASK DATE],    DATE_DIM.[CALENDAR YEAR NAME],    DATE_DIM.[CALENDAR YEAR WEEK NUMBER],    TASK_FCT.[PERSON OCCURS],     TASK_DIM.[TASK TYPE NAME],    TASK_DIM.[TASK STATUS NAME],    DATE_DIM.[CALENDAR YEAR NAME],    DATE_DIM.[CALENDAR YEAR WEEK NUMBER],    DATE_DIM.[CALENDAR WEEK END DATE],    ORG_DIM.[SOURCE SYSTEM KEY TEXT],    --SALE_HIER_DIM.ORZN_DEPT_CDE,    --SALE_HIER_DIM.ORZN_ZONE_CDE,    ORG_DIM.[FIRST NAME] + ' ' + ORG_DIM.[LAST NAME]     --ORG_DIM.[JOB TYPE CODE],    --ORG_DIM.[ADJUSTED SERVICE DATE],    --ORG_DIM.[EMPLOYEE STATUS TYPE CODE]   HAVING     SUM(TASK_FCT.[TASK OCCURS]) > 0   




Source Tables: ['ENTERPRISEDATAMART.DM_01']
{'PERFORMANCE YEAR WEEK NUMBER': ['CALENDAR YEAR WEEK NUMBER'], 'TSID': ['SOURCE SYSTEM KEY TEXT'], 'JOB_TYP_CDE': ['FIRST NAME', 'LAST NAME', 'JOB TYPE CODE'], 'KEY]': [], 'EMP_STS_TYP_CDE': ['EMPLOYEE STATUS TYPE CODE'], 'ORZN_DEPT_CDE': [], 'PERFORMANCE YEAR NAME': ['CALENDAR YEAR NAME'], 'OCCURS]': [], 'ADJ_SVC_DT': ['ADJUSTED SERVICE DATE'], 'NAME]': [], 'DATE]': [], 'TASK_OCCURS': ['TASK OCCURS'], 'ORZN_ZONE_CDE': []}



28)

SELECT EMP_ID AS TSID, EMP_NM AS EMPLOYEE_NAME, JOB_TYP_CDE AS JOB_CODE, JOB_TYP_DSCR AS JOB_DESCRIPTION, ORZN_DIV_CDE AS DIVISION_CODE, ORZN_DIV_DSCR AS DIVISION_DESCRIPTION, ORZN_DEPT_CDE AS DEPARTMENT_CODE, ORZN_DEPT_DSCR AS DEPARTMENT_DESCRIPTION, EMP_STS_TYP_DSCR AS EMP_STATUS, ORIG_HIRE_DT AS ORIG_HIRE_DATE, HIRE_DT AS HIRE_DATE, RHIR_DT AS REHIRE_DATE, TRMN_DT AS TERMINATION_DATE, EMP_SVC_DT AS SERVICE_DATE, ADJ_SVC_DT AS ADJUSTED_SERVICE_DATE, /* TENURE */  (DAYS(CURRENT_DATE)-DAYS(ADJ_SVC_DT) ) / 365.25 AS TENURE, /* TENURE_GROUP */  (CASE WHEN ((DAYS(CURRENT_DATE)-DAYS(ADJ_SVC_DT))/365.25 ) <= 1 THEN 'NFA1'              WHEN ((DAYS(CURRENT_DATE)-DAYS(ADJ_SVC_DT))/365.25 ) > 1 AND              ((DAYS(CURRENT_DATE)-DAYS(ADJ_SVC_DT))/365.25 ) <= 2 THEN 'NFA2'             WHEN ((DAYS(CURRENT_DATE)-DAYS(ADJ_SVC_DT))/365.25 ) > 2 AND           ((DAYS(CURRENT_DATE)-DAYS(ADJ_SVC_DT))/365.25 ) <= 3 THEN 'NFA3'           WHEN ((DAYS(CURRENT_DATE)-DAYS(ADJ_SVC_DT))/365.25 ) > 3 AND              ((DAYS(CURRENT_DATE)-DAYS(ADJ_SVC_DT))/365.25 ) <= 4 THEN 'NFA4'           WHEN ((DAYS(CURRENT_DATE)-DAYS(ADJ_SVC_DT))/365.25 ) > 4 AND               ((DAYS(CURRENT_DATE)-DAYS(ADJ_SVC_DT))/365.25 ) <= 5 THEN 'VET5'           WHEN ((DAYS(CURRENT_DATE)-DAYS(ADJ_SVC_DT))/365.25 ) > 5 AND               ((DAYS(CURRENT_DATE)-DAYS(ADJ_SVC_DT))/365.25 ) <= 6 THEN 'VET6'            WHEN ((DAYS(CURRENT_DATE)-DAYS(ADJ_SVC_DT))/365.25 ) > 6 AND                 ((DAYS(CURRENT_DATE)-DAYS(ADJ_SVC_DT))/365.25 ) <= 7 THEN 'VET7'            WHEN ((DAYS(CURRENT_DATE)-DAYS(ADJ_SVC_DT))/365.25 ) > 7 AND                ADJ_SVC_DT IS NOT NULL THEN 'VET8+' ELSE 'OTHER'       END) AS TENURE_GROUP FROM ''HUMAN_RESOURCES''.''CNF_EMP_DIM_DTL_CURR_CFDL'' WHERE CURR_ROW_IND = 'Y'']),    #'FILTERED ROWS' = TABLE.SELECTROWS(SOURCE, EACH [DIVISION_DESCRIPTION] <> 'NA'),    #'TAKE OUT 'ADVISOR GROUP'' = TABLE.REPLACEVALUE(#'FILTERED ROWS',' ADVISOR GROUP','',REPLACER.REPLACETEXT,{'DEPARTMENT_DESCRIPTION'}),    #'TRIM DEPT FOR TRAILING SPACES' = TABLE.ADDCOLUMN(#'TAKE OUT 'ADVISOR GROUP'', 'TRIM', EACH TEXT.TRIM([DEPARTMENT_CODE]), TYPE TEXT),    #'RENAMED COLUMNS' = TABLE.RENAMECOLUMNS(#'TRIM DEPT FOR TRAILING SPACES',{{'TRIM', 'DEPT TRIMMED'}}),    #'VIRTUAL ADVICE DEPTS TO 0383' = TABLE.ADDCOLUMN(#'RENAMED COLUMNS', 'DEPT CODE_VA', EACH IF LIST.CONTAINS({'5405','5407','5408','5409'},[DEPT TRIMMED]) THEN '0383' ELSE [DEPT TRIMMED]),    #'DEPT - DESCRIPTION' = TABLE.ADDCOLUMN(#'VIRTUAL ADVICE DEPTS TO 0383', 'DEPARTMENT', EACH IF[DEPT CODE_VA] = '0383' THEN[DEPT CODE_VA]&' - '&[DIVISION_DESCRIPTION]ELSE [DEPT CODE_VA]&' - '&[DEPARTMENT_DESCRIPTION]),    #'REORDERED COLUMNS' = TABLE.REORDERCOLUMNS(#'DEPT - DESCRIPTION',{'TSID', 'EMPLOYEE_NAME', 'JOB_CODE', 'JOB_DESCRIPTION', 'DIVISION_CODE', 'DIVISION_DESCRIPTION', 'DEPARTMENT_CODE', 'DEPARTMENT_DESCRIPTION', 'DEPARTMENT', 'DEPT TRIMMED', 'EMP_STATUS', 'ORIG_HIRE_DATE', 'HIRE_DATE', 'REHIRE_DATE', 'TERMINATION_DATE', 'SERVICE_DATE', 'ADJUSTED_SERVICE_DATE', 'TENURE', 'TENURE_GROUP'}),    #'RENAMED COLUMNS1' = TABLE.RENAMECOLUMNS(#'REORDERED COLUMNS',{{'JOB_CODE', 'JOB CODE'}, {'JOB_DESCRIPTION', 'JOB DESCRIPTION'}, {'EMPLOYEE_NAME', 'NAME'}})IN    #'RENAMED COLUMNS1	



Source Tables: []
{'REHIRE_DATE': ['RHIR_DT'], 'DEPARTMENT_DESCRIPTION': ['ORZN_DEPT_DSCR'], 'ADJUSTED_SERVICE_DATE': ['ADJ_SVC_DT'], 'EMP_STATUS': ['EMP_STS_TYP_DSCR'], 'JOB_CODE': ['JOB_TYP_CDE'], 'HIRE_DATE': ['HIRE_DT'], 'TENURE_GROUP': [], 'DIVISION_DESCRIPTION': ['ORZN_DIV_DSCR'], 'TENURE': [], 'TSID': ['EMP_ID'], 'EMPLOYEE_NAME': ['EMP_NM'], 'DIVISION_CODE': ['ORZN_DIV_CDE'], 'ORIG_HIRE_DATE': ['ORIG_HIRE_DT'], 'TERMINATION_DATE': ['TRMN_DT'], 'JOB_DESCRIPTION': ['JOB_TYP_DSCR'], 'DEPARTMENT_CODE': ['ORZN_DEPT_CDE'], 'SERVICE_DATE': ['EMP_SVC_DT']}







23)

SELECT PERS_DIM.[SOURCE SYSTEM KEY TEXT] AS THRIVENTID,    -- APPT_FCT.[WORKER APPOINTMENT ASSOCIATION],       APPT_FCT.[APPOINTMENT DIMENSION SURROGATE KEY],       APPT_FCT.[PERSON DIMENSION SURROGATE KEY],    -- APPT_FCT.[APPOINTMENT ORGANIZATION DIMENSION KEY],    -- APPT_FCT.[APPOINTMENT ORGANIZATION DIMENSION SURROGATE KEY],       SUM(APPT_FCT.[APPOINTMENT OCCURS]) [APPT_OCCURS],       MAX(APPT_FCT.[PERSON OCCURS]) [PERSON OCCURS],       MBR_DIM.[MEMBERSHIP TYPE DESCRIPTION],       APPT_DIM.[APPOINTMENT DATE],       APPT_DIM.[APPOINTMENT TYPE DESCRIPTION] [APPOINTMENT TYPE CODE],       DATE_DIM.[CALENDAR YEAR NAME],       ORG_DIM.[SOURCE SYSTEM KEY TEXT] [EMP_ID],     --SALE_HIER_DIM.ORZN_DEPT_CDE [RFO ZONE NAME],     --SALE_HIER_DIM.ORZN_ZONE_CDE [RFO ZONE IDENTIFIER],       ORG_DIM.[FIRST NAME] + ' ' + ORG_DIM.[LAST NAME],       (SELECT MAX(A.[LIFE SEGMENT VALUE DESCRIPTION])          FROM ENTERPRISEDATAMART.DM_01.[PERSON DIMENSION] A         WHERE APPT_FCT.[PERSON DIMENSION SURROGATE KEY]=A.[PERSON DIMENSION SURROGATE KEY]         AND A.[CURRENT ROW INDICATOR] = 'Y') AS [LIFE SEGMENT VALUE DESCRIPTION]     FROM ENTERPRISEDATAMART.DM_01.[APPOINTMENT COMBINE FACT] APPT_FCT LEFT JOIN         ENTERPRISEDATAMART.DM_01.[PERSON DIMENSION] AS PERS_DIM     ON (APPT_FCT.[PERSON DIMENSION SURROGATE KEY]=PERS_DIM.[PERSON DIMENSION SURROGATE KEY] AND         APPT_FCT.[PERSON DIMENSION VERSION NUMBER] = PERS_DIM.[PERSON DIMENSION VERSION NUMBER]) LEFT JOIN        ENTERPRISEDATAMART.DM_01.[MEMBERSHIP TYPE DIMENSION] MBR_DIM     ON (APPT_FCT.[MEMBERSHIP TYPE DIMENSION SURROGATE KEY]=MBR_DIM.[MEMBERSHIP TYPE DIMENSION SURROGATE KEY]) LEFT JOIN         ENTERPRISEDATAMART.DM_01.[APPOINTMENT DIMENSION] APPT_DIM     ON (APPT_FCT.[APPOINTMENT DIMENSION SURROGATE KEY]=APPT_DIM.[APPOINTMENT DIMENSION SURROGATE KEY]) LEFT JOIN         ENTERPRISEDATAMART.DM_01.[DATE DIMENSION] DATE_DIM     ON (APPT_DIM.[APPOINTMENT DATE]=DATE_DIM.[CALENDAR DATE DATE]) LEFT JOIN         ENTERPRISEDATAMART.DM_01.[ORGANIZATION DIMENSION] ORG_DIM     ON ((APPT_FCT.[APPOINTMENT ORGANIZATION DIMENSION SURROGATE KEY]=ORG_DIM.[ORGANIZATION DIMENSION SURROGATE KEY]) AND         ((ORG_DIM.[EFFECTIVE BEGIN DATE] <= APPT_DIM.[APPOINTMENT DATE]) AND (APPT_DIM.[APPOINTMENT DATE] <= ORG_DIM.[EFFECTIVE END DATE]))) LEFT JOIN           ENTERPRISEDATAMART.DM_01.[SALE_HIER_DIM] SALE_HIER_DIM     ON ((ORG_DIM.[SOURCE SYSTEM KEY TEXT]=SALE_HIER_DIM.[SALE_HIER_ID] AND  (SALE_HIER_DIM.EFF_BEG_DT<=APPT_DIM.[APPOINTMENT DATE]) AND  (APPT_DIM.[APPOINTMENT DATE]<= SALE_HIER_DIM.EFF_END_DT) AND    SALE_HIER_DIM.CURR_ROW_IND = 'Y'))  WHERE APPT_DIM.[CURRENT ROW INDICATOR] = 'Y'   AND APPT_DIM.[APPOINTMENT CREATE DATE OVER 14 DAYS] = 'N'   AND APPT_FCT.[PERSON DIMENSION SURROGATE KEY] <> 0   AND APPT_FCT.[APPOINTMENT STATUS NAME] <> 'DECLINED'   AND APPT_DIM.[APPOINTMENT TYPE CODE] <> 'UNK'   AND SALE_HIER_DIM.ORZN_DEPT_CDE IN ('0115','0165','0190','0240','0283','0291','0361','0365', '0383','0384','0410','0435','0475','0496','0525','0529','0810')  AND (ORG_DIM.[JOB TYPE CODE] IN ('002000', '002003', '002008', '002010', '002011', '002012', '002016', '002022', '002024', '002025', '002026', '002027', '002030', '002031', '002032', '003100', '003500')   OR  ORG_DIM.[DEPARTMENT IDENTIFIER] IN ('5405','5407','5408','5409','1701','1702','1703','0383'))    AND APPT_DIM.[EVENT RESULT DESCRIPTION] NOT IN ('NO SHOW','CANCELLED')   AND DATE_DIM.[CALENDAR YEAR NAME] IN ('2022','2023','2024') GROUP BY --APPT_FCT.[WORKER APPOINTMENT ASSOCIATION],   APPT_FCT.[APPOINTMENT DIMENSION SURROGATE KEY],   APPT_FCT.[PERSON DIMENSION SURROGATE KEY],   MBR_DIM.[MEMBERSHIP TYPE DESCRIPTION],   APPT_DIM.[APPOINTMENT DATE],   APPT_DIM.[APPOINTMENT TYPE DESCRIPTION],   DATE_DIM.[CALENDAR YEAR NAME], --SALE_HIER_DIM.ORZN_DEPT_CDE, --SALE_HIER_DIM.ORZN_ZONE_CDE,   ORG_DIM.[SOURCE SYSTEM KEY TEXT],   ORG_DIM.[FIRST NAME] + ' ' + ORG_DIM.[LAST NAME],   PERS_DIM.[SOURCE SYSTEM KEY TEXT]  --APPT_FCT.[APPOINTMENT ORGANIZATION DIMENSION KEY], --APPT_FCT.[APPOINTMENT ORGANIZATION DIMENSION SURROGATE KEY]    HAVING  SUM(APPT_FCT.[APPOINTMENT OCCURS])>0']),    #'CHANGED TYPE' = TABLE.TRANSFORMCOLUMNTYPES(SOURCE,{{'APPOINTMENT DATE', TYPE DATE}})IN    #'CHANGED TYPE	






Source Tables: ['ENTERPRISEDATAMART.DM_01']
{'MEMBERSHIP TYPE DESCRIPTION': [], 'APPOINTMENT ORGANIZATION DIMENSION KEY': [], 'PERSON OCCURS': ['PERSON OCCURS'], 'ASSOCIATION]': [], 'DESCRIPTION])': ['LIFE SEGMENT VALUE DESCRIPTION'], 'APPOINTMENT DIMENSION SURROGATE KEY': [], 'THRIVENTID': ['SOURCE SYSTEM KEY TEXT'], 'APPT_OCCURS': ['APPOINTMENT OCCURS'], 'EMP_ID': ['SOURCE SYSTEM KEY TEXT'], 'APPOINTMENT DATE': [], 'APPOINTMENT TYPE CODE': ['APPOINTMENT TYPE DESCRIPTION'], 'APPOINTMENT ORGANIZATION DIMENSION SURROGATE KEY': [], 'PERSON DIMENSION SURROGATE KEY': [], 'CALENDAR YEAR NAME': [], 'RFO ZONE NAME': [], 'RFO ZONE IDENTIFIER': [], 'LAST NAME': ['FIRST NAME']}



16) and 14)

SELECT  APPT_FCT.[WORKER APPOINTMENT ASSOCIATION],  APPT_FCT.[APPOINTMENT DIMENSION SURROGATE KEY],  APPT_FCT.[PERSON DIMENSION SURROGATE KEY],  SUM(APPT_FCT.[APPOINTMENT OCCURS]) [APPT_OCCURS],  MBR_DIM.[MEMBERSHIP TYPE CODE],  MBR_DIM.[MEMBERSHIP TYPE DESCRIPTION],  APPT_DIM.[APPOINTMENT DATE],        CASE WHEN APPT_DIM.[APPOINTMENT TYPE CODE] IN ('GATHER DATA') THEN 'DISCOVER'             WHEN APPT_DIM.[APPOINTMENT TYPE CODE] IN ('TAKE ACTION') THEN 'DELIVER'             WHEN APPT_DIM.[APPOINTMENT TYPE CODE] NOT IN ('GATHER DATA','TAKE ACTION') THEN APPT_DIM.[APPOINTMENT TYPE CODE]        END AS [APPOINTMENT TYPE CODE],        CASE WHEN APPT_DIM.[APPOINTMENT TYPE CODE] IN ('GATHER DATA') THEN 'DISCOVER'             WHEN APPT_DIM.[APPOINTMENT TYPE CODE] IN ('TAKE ACTION') THEN 'DELIVER'             WHEN APPT_DIM.[APPOINTMENT TYPE CODE] NOT IN ('GATHER DATA','TAKE ACTION') THEN APPT_DIM.[APPOINTMENT TYPE DESCRIPTION]        END AS [APPOINTMENT TYPE DESCRIPTION],  --APPT_DIM.[APPOINTMENT TYPE CODE],  --APPT_DIM.[APPOINTMENT TYPE DESCRIPTION],   CASE WHEN APPT_DIM.[FIELD USER COUNT] <> 0 AND APPT_DIM.[APPOINTMENT TYPE CODE] IN ('CONNECT','GATHER DATA','TAKE ACTION','STRATEGY CALL/MEETING','REVIEW','SERVICE','DISCOVER','DELIVER')    THEN 1    ELSE 0    END [JFW_IND],   DATE_DIM.[CALENDAR YEAR NAME],  DATE_DIM.[CALENDAR YEAR WEEK NUMBER],  (LEFT(SALE_HIER_DIM.[ORZN_ZONE_CDE],4)) [HISTORICAL RFO],  SALE_HIER_DIM.ORZN_ZONE_CDE [HISTORICAL MARKET],         SALE_HIER_DIM.ORZN_SUB_DEPT_CDE [HISTORICAL MVP],  APPT_ORG_HIST.[SOURCE SYSTEM KEY TEXT] [TSID],  APPT_ORG_HIST.[ADJUSTED SERVICE DATE],  APPT_ORG_HIST.[EMPLOYEE STATUS TYPE DESCRIPTION],  APPT_ORG_HIST.[FINANCIAL PROFESSIONAL TENURE] [HISTORICAL FP TENURE],  APPT_ORG_HIST.[FINANCIAL PROFESSIONAL TENURE GROUP] [HISTORICAL FP TENURE GROUP],  APPT_ORG_HIST.[EMPLOYEE DISPLAY NAME] [FP NAME],  APPT_ORG_HIST.[JOB TYPE CODE] [HISTORICAL JOB TYPE CODE],  APPT_ORG_HIST.[JOB TYPE DESCRIPTION] [HISTORICAL JOB TYPE DESCRIPTION]  FROM ENTERPRISEDATAMART.DM_01.[APPOINTMENT COMBINE FACT] APPT_FCT LEFT JOIN ENTERPRISEDATAMART.DM_01.[MEMBERSHIP TYPE DIMENSION] MBR_DIM  ON (APPT_FCT.[MEMBERSHIP TYPE DIMENSION SURROGATE KEY]=MBR_DIM.[MEMBERSHIP TYPE DIMENSION SURROGATE KEY])  LEFT JOIN ENTERPRISEDATAMART.DM_01.[APPOINTMENT DIMENSION] APPT_DIM  ON (APPT_FCT.[APPOINTMENT DIMENSION SURROGATE KEY]=APPT_DIM.[APPOINTMENT DIMENSION SURROGATE KEY])  LEFT JOIN ENTERPRISEDATAMART.DM_01.[DATE DIMENSION] DATE_DIM  ON (APPT_DIM.[APPOINTMENT DATE]=DATE_DIM.[CALENDAR DATE DATE])  LEFT JOIN ENTERPRISEDATAMART.DM_01.[APPOINTMENT ORGANIZATION DIMENSION] APPT_ORG_HIST     ON ((APPT_FCT.[APPOINTMENT ORGANIZATION DIMENSION SURROGATE KEY]=APPT_ORG_HIST.[APPOINTMENT ORGANIZATION DIMENSION SURROGATE KEY])     AND ((APPT_ORG_HIST.[EFFECTIVE BEGIN DATE] <= APPT_DIM.[APPOINTMENT DATE]) AND (APPT_DIM.[APPOINTMENT DATE] <= APPT_ORG_HIST.[EFFECTIVE END DATE])))  LEFT JOIN ENTERPRISEDATAMART.DM_01.[SALE_HIER_DIM] SALE_HIER_DIM  ON ((SALE_HIER_DIM.EFF_BEG_DT<=APPT_DIM.[APPOINTMENT DATE])   AND (APPT_DIM.[APPOINTMENT DATE]<= DATEADD(DAY,-1,SALE_HIER_DIM.EFF_END_DT))   AND SALE_HIER_DIM.CURR_ROW_IND = 'Y'  AND APPT_ORG_HIST.[SOURCE SYSTEM KEY TEXT]=SALE_HIER_DIM.[SALE_HIER_ID])   WHERE   APPT_DIM.[CURRENT ROW INDICATOR] = 'Y'  AND APPT_DIM.[APPOINTMENT CREATE DATE OVER 14 DAYS] = 'N'  AND APPT_FCT.[PERSON DIMENSION SURROGATE KEY] <> 0         AND APPT_FCT.[APPOINTMENT STATUS NAME] <> 'DECLINED'  AND SALE_HIER_DIM.ORZN_DEPT_CDE IN ('0115','0190','0283','0291','0361','0383','0384','0435','0525')   AND (APPT_ORG_HIST.[JOB TYPE CODE] IN ('002000', '002003', '002008', '002010', '002011', '002012', '002016', '002022', '002024', '002025', '002026', '002027', '002030', '002031', '002032', '003100', '003500')  OR APPT_ORG_HIST.[DEPARTMENT IDENTIFIER] IN ('5405','5407','5408','5409','1701','1702','1703','0383'))   AND APPT_DIM.[EVENT RESULT DESCRIPTION] NOT IN ('NO SHOW','CANCELLED')  AND DATE_DIM.[CALENDAR YEAR NAME] IN ('2022','2023','2024')         AND APPT_ORG_HIST.[SOURCE SYSTEM KEY TEXT] NOT IN ('TS06033', 'TS13320', 'TS21623', 'TS22934', 'TS32012', 'TS34394', 'TS34662', 'TS67185')         AND APPT_DIM.[APPOINTMENT TYPE CODE] <> 'UNK'  GROUP BY  APPT_FCT.[WORKER APPOINTMENT ASSOCIATION],  APPT_FCT.[APPOINTMENT DIMENSION SURROGATE KEY],  APPT_FCT.[PERSON DIMENSION SURROGATE KEY],  MBR_DIM.[MEMBERSHIP TYPE CODE],  MBR_DIM.[MEMBERSHIP TYPE DESCRIPTION],  APPT_DIM.[APPOINTMENT DATE],  APPT_DIM.[APPOINTMENT TYPE CODE],  APPT_DIM.[APPOINTMENT TYPE DESCRIPTION],         APPT_DIM.[FIELD USER COUNT],  DATE_DIM.[CALENDAR YEAR NAME],  DATE_DIM.[CALENDAR YEAR WEEK NUMBER],  SALE_HIER_DIM.ORZN_DEPT_CDE,  SALE_HIER_DIM.ORZN_ZONE_CDE,         SALE_HIER_DIM.ORZN_SUB_DEPT_CDE,  APPT_ORG_HIST.[SOURCE SYSTEM KEY TEXT],  APPT_ORG_HIST.[ADJUSTED SERVICE DATE],  APPT_ORG_HIST.[EMPLOYEE STATUS TYPE DESCRIPTION],  APPT_ORG_HIST.[FINANCIAL PROFESSIONAL TENURE],  APPT_ORG_HIST.[FINANCIAL PROFESSIONAL TENURE GROUP],  APPT_ORG_HIST.[EMPLOYEE DISPLAY NAME],  APPT_ORG_HIST.[JOB TYPE CODE],  APPT_ORG_HIST.[JOB TYPE DESCRIPTION]  HAVING  SUM(APPT_FCT.[APPOINTMENT OCCURS])>0']),    #'FILTERED ROWS' = TABLE.SELECTROWS(SOURCE, EACH [APPT_OCCURS] > 0),    #'FILTERED ROWS1' = TABLE.SELECTROWS(#'FILTERED ROWS', EACH ([WORKER APPOINTMENT ASSOCIATION] = 'OWNER') AND ([APPOINTMENT TYPE DESCRIPTION] = 'CONNECT') AND ([MEMBERSHIP TYPE DESCRIPTION] <> 'BENEFIT')),    #'CHANGED TYPE' = TABLE.TRANSFORMCOLUMNTYPES(#'FILTERED ROWS1',{{'APPOINTMENT DATE', TYPE DATE}}),    #'ADDED CUSTOM' = TABLE.ADDCOLUMN(#'CHANGED TYPE', 'CALYR_CONNECT', EACH DATE.YEAR([APPOINTMENT DATE])),    #'CHANGED TYPE1' = TABLE.TRANSFORMCOLUMNTYPES(#'ADDED CUSTOM',{{'CALYR_CONNECT', INT64.TYPE}})IN    #'CHANGED TYPE1	
  	




Source Tables: ['ENTERPRISEDATAMART.DM_01']
{'EMPLOYEE STATUS TYPE DESCRIPTION': [], 'MEMBERSHIP TYPE DESCRIPTION': [], 'HISTORICAL RFO': ['ORZN_ZONE_CDE'], 'CALENDAR YEAR NAME': [], 'CALENDAR YEAR WEEK NUMBER': [], 'APPOINTMENT TYPE DESCRIPTION': ['APPOINTMENT TYPE CODE', 'APPOINTMENT TYPE DESCRIPTION'], 'MEMBERSHIP TYPE CODE': [], 'APPOINTMENT TYPE CODE': ['APPOINTMENT TYPE CODE'], 'FP NAME': ['EMPLOYEE DISPLAY NAME'], 'ADJUSTED SERVICE DATE': [], 'JFW_IND': ['FIELD USER COUNT', 'APPOINTMENT TYPE CODE'], 'HISTORICAL JOB TYPE DESCRIPTION': ['JOB TYPE DESCRIPTION'], 'HISTORICAL MVP': [], 'ASSOCIATION]': [], 'APPT_OCCURS': ['APPOINTMENT OCCURS'], 'HISTORICAL MARKET': [], 'APPOINTMENT DIMENSION SURROGATE KEY': [], 'HISTORICAL FP TENURE GROUP': ['FINANCIAL PROFESSIONAL TENURE GROUP'], 'HISTORICAL FP TENURE': ['FINANCIAL PROFESSIONAL TENURE'], 'PERSON DIMENSION SURROGATE KEY': [], 'APPOINTMENT DATE': [], 'TSID': ['SOURCE SYSTEM KEY TEXT'], 'HISTORICAL JOB TYPE CODE': ['JOB TYPE CODE']} 





11)

SELECT   A.[ORGANIZATION DIMENSION SURROGATE KEY]       ,A.[ORGANIZATION DIMENSION VERSION NUMBER]       ,A.[ORGANIZATION LEAD DIMENSION SURROGATE KEY]       ,A.[ORGANIZATION LEAD DIMENSION VERSION NUMBER]       ,A.[PACE PERFORMANCE TARGET DIMENSION SURROGATE KEY]       ,A.[PACE PERFORMANCE TARGET VERSION NUMBER]       ,A.[PROCESS DATE]       ,CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS77919','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END AS [TENURE DATA]          ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS77919','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, DATEADD(MM, DATEDIFF(MM, 0, GETDATE()) + 1, -1)) AS MONTH          --,DATEDIFF(MONTH, [TENURE DATA], DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) +1, 0))) AS EOQ_MONTH    ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS77919','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END) AS EOQ_MONTH    --,(DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0))) AS CURRENT_QTR    /*,CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END AS QUARTER_END*/    --,DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()), 0)) AS PREVIOUS_QTR          ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS77919','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, DATEADD(YY, DATEDIFF(YY, 0, GETDATE()) + 1, -1)) AS EOY_MONTH          ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS77919','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, [PROCESS DATE]) -           (DATEPART(DD,CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)*1.0-1.0)/DAY(EOMONTH(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)) +           (DATEPART(DD,[PROCESS DATE])*1.0)/DAY(EOMONTH([PROCESS DATE])) AS TENURE_MONTHS         ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS77919','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END,DATEADD(YY, DATEDIFF(YY, 0, GETDATE()) + 1, -1)) - 1 +   1-1.0*(DAY(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS77919','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END), -1))   + 1.0*(DAY(DATEADD(YY, DATEDIFF(YY, 0, GETDATE()) + 1, -1))-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, DATEADD(YY, DATEDIFF(YY, 0, GETDATE()) + 1, -1)), -1)) AS EOY_TENURE         ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS77919','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END,CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END) - 1 +   1-1.0*(DAY(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS77919','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END), -1))   + 1.0*(DAY(CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END)-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END), -1)) AS EOQ_TENURE        ,DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS77919','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END,DATEADD(MM, DATEDIFF(MM, 0, GETDATE()) + 1, -1)) - 1 +   1-1.0*(DAY(CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS77919','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END)-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS74049','TS71560','TS77919','TS74642') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END), -1))   + 1.0*(DAY(DATEADD(MM, DATEDIFF(MM, 0, GETDATE()) + 1, -1))-1)/ DAY(DATEADD(M, DATEDIFF(M,-1, DATEADD(MM, DATEDIFF(MM, 0, GETDATE()) + 1, -1)), -1)) AS EOM_TENURE       ,A.[PRODUCTION DATE]       ,A.[SNAPSHOT TYPE CODE]       ,A.[BUSINESS INTERRUPTION DAY VALUE]          ,B.[SOURCE SYSTEM KEY TEXT] AS TSID          ,CONCAT(B.[FIRST NAME],' ',B.[LAST NAME]) AS FP_NAME          ,B.[JOB TYPE CODE]          ,CONCAT((LEFT(SALE_HIER_DIM.[ORZN_ZONE_CDE],4)),'-',SALE_HIER_DIM.ORZN_DEPT_DSCR) AS TAG       ,SALE_HIER_DIM.ORZN_ZONE_CDE [MARKET]          ,C.[SOURCE SYSTEM KEY TEXT] AS LEADER_TSID          ,CONCAT(C.[FIRST NAME],' ',C.[LAST NAME]) AS LEADER_NAME       ,A.[LIFE AND HEALTH GRID CREDIT AMOUNT]       ,A.[LIFE AND HEALTH PRORATED GRID CREDIT AMOUNT] AS LH_PACE_TARGET       ,A.[GRID CREDIT AMOUNT]       ,[PRORATED GRID CREDIT AMOUNT] AS PACE_TARGET          ,D.[GRID CREDIT AMOUNT] AS EOY_TARGET          ,D.[GRID CREDIT RANGE AMOUNT] AS EOY_RANGE_AMT          ,E.[GRID CREDIT AMOUNT] AS EOQ_TARGET          ,E.[GRID CREDIT RANGE AMOUNT] AS EOQ_RANGE_AMT          ,F.[GRID CREDIT AMOUNT] AS EOM_TARGET          ,F.[GRID CREDIT RANGE AMOUNT] AS EOM_RANGE_AMT          ,CASE WHEN [PRIOR ADVISOR EXPERIENCE INDICATOR] = 'Y' OR B.[JOB TYPE CODE] = '002010' THEN ''          WHEN A.[GRID CREDIT AMOUNT] > A.[PRORATED GRID CREDIT AMOUNT] THEN 'ABOVE'          WHEN A.[GRID CREDIT AMOUNT] < A.[PRORATED GRID CREDIT AMOUNT] THEN 'BELOW'    ELSE ''          END AS ABOVE_BELOW          ,CASE WHEN [PRIOR ADVISOR EXPERIENCE INDICATOR] = 'Y' OR B.[JOB TYPE CODE] = '002010' THEN ''          WHEN A.[LIFE AND HEALTH GRID CREDIT AMOUNT] > A.[LIFE AND HEALTH PRORATED GRID CREDIT AMOUNT] THEN 'ABOVE'          WHEN A.[LIFE AND HEALTH GRID CREDIT AMOUNT] < A.[LIFE AND HEALTH PRORATED GRID CREDIT AMOUNT] THEN 'BELOW'    ELSE ''          END AS ABOVE_BELOW_LH      ,[PRIOR ADVISOR EXPERIENCE INDICATOR]        ,CASE WHEN A.[PROCESS DATE] = MAX_PROCESS_DATE.[MAX PROCESS DATE]THEN 'Y'          ELSE 'N'          END AS CURR_WK_IND   FROM [ENTERPRISEDATAMART].[DM_01].[PACE PERFORMANCE SNAPSHOT FACT] A   INNER JOIN [ENTERPRISEDATAMART].[DM_01].[ORGANIZATION DIMENSION] B    ON (A.[ORGANIZATION DIMENSION SURROGATE KEY]=B.[ORGANIZATION DIMENSION SURROGATE KEY] AND        A.[PROCESS DATE]>=B.[EFFECTIVE BEGIN DATE] AND A.[PROCESS DATE]<=B.[EFFECTIVE END DATE])   INNER JOIN (SELECT MAX([PROCESS DATE]) [MAX PROCESS DATE] FROM [DM_01].[PACE PERFORMANCE SNAPSHOT FACT]) AS MAX_PROCESS_DATE ON 'A' = 'A'   INNER JOIN [DM_01].[DATE DIMENSION] DD ON (A.[PROCESS DATE]=DD.[CALENDAR DATE DATE])    LEFT JOIN [ENTERPRISEDATAMART].[DM_01].[SALE_HIER_DIM] SALE_HIER_DIM     ON ((     (SALE_HIER_DIM.EFF_BEG_DT<=A.[PROCESS DATE])         OR         (         (A.[PROCESS DATE]<(SELECT MIN(EFF_BEG_DT) FROM [ENTERPRISEDATAMART].[DM_01].[SALE_HIER_DIM] SUBQ WHERE B.[SOURCE SYSTEM KEY TEXT]=SUBQ.[SALE_HIER_ID] AND SUBQ.CURR_ROW_IND = 'Y'))         AND         SALE_HIER_DIM.EFF_BEG_DT=(SELECT MIN(EFF_BEG_DT) FROM [ENTERPRISEDATAMART].[DM_01].[SALE_HIER_DIM] SUBQ WHERE B.[SOURCE SYSTEM KEY TEXT]=SUBQ.[SALE_HIER_ID] AND SUBQ.CURR_ROW_IND = 'Y')         ))         AND          (A.[PROCESS DATE]<= DATEADD(DAY,-1,SALE_HIER_DIM.EFF_END_DT))         AND SALE_HIER_DIM.CURR_ROW_IND = 'Y'         AND B.[SOURCE SYSTEM KEY TEXT]=SALE_HIER_DIM.[SALE_HIER_ID])             INNER JOIN [ENTERPRISEDATAMART].[DM_01].[ORGANIZATION DIMENSION] C    ON (A.[ORGANIZATION LEAD DIMENSION SURROGATE KEY]=C.[ORGANIZATION DIMENSION SURROGATE KEY] AND     A.[PROCESS DATE]>=C.[EFFECTIVE BEGIN DATE] AND A.[PROCESS DATE]<=C.[EFFECTIVE END DATE])   LEFT JOIN [ENTERPRISEDATAMART].[DM_01].[PACE PERFORMANCE TARGET DIMENSION] D    ON (DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS77919','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, DATEADD(YY, DATEDIFF(YY, 0, GETDATE()) + 1, -1))=D.[CALENDAR YEAR MONTH NUMBER])   LEFT JOIN [ENTERPRISEDATAMART].[DM_01].[PACE PERFORMANCE TARGET DIMENSION] E    ON (DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS77919','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END,CASE WHEN GETDATE()>DATEFROMPARTS(YEAR(GETDATE()),10,16) THEN (DATEADD (DD, -1, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()) + 1, 0)))    ELSE DATEADD (DD, +14, DATEADD(QQ, DATEDIFF(QQ, 0, GETDATE()-15) + 1, 0))    END)=E.[CALENDAR YEAR MONTH NUMBER])   LEFT JOIN [ENTERPRISEDATAMART].[DM_01].[PACE PERFORMANCE TARGET DIMENSION] F    ON (DATEDIFF(MONTH, CASE WHEN B.[SOURCE SYSTEM KEY TEXT] IN ('TS77919','TS78250','TS75194') THEN B.[ADJUSTED SERVICE DATE] ELSE A.[TENURE DATA] END, DATEADD(MM, DATEDIFF(MM, 0, GETDATE()) + 1, -1))=F.[CALENDAR YEAR MONTH NUMBER])']),    #'ADDED CUSTOM' = TABLE.ADDCOLUMN(SOURCE, 'ABOVE/BELOW', EACH IF [TENURE_MONTHS] <= 2.25 THEN '' ELSE [ABOVE_BELOW]),    #'REMOVED COLUMNS' = TABLE.REMOVECOLUMNS(#'ADDED CUSTOM',{'ABOVE_BELOW'}),    #'REORDERED COLUMNS' = TABLE.REORDERCOLUMNS(#'REMOVED COLUMNS',{'ORGANIZATION DIMENSION SURROGATE KEY', 'ORGANIZATION DIMENSION VERSION NUMBER', 'ORGANIZATION LEAD DIMENSION SURROGATE KEY', 'ORGANIZATION LEAD DIMENSION VERSION NUMBER', 'PACE PERFORMANCE TARGET DIMENSION SURROGATE KEY', 'PACE PERFORMANCE TARGET VERSION NUMBER', 'PROCESS DATE', 'TENURE DATA', 'MONTH', 'EOQ_MONTH', 'EOY_MONTH', 'TENURE_MONTHS', 'EOY_TENURE', 'EOQ_TENURE', 'EOM_TENURE', 'PRODUCTION DATE', 'SNAPSHOT TYPE CODE', 'BUSINESS INTERRUPTION DAY VALUE', 'TSID', 'FP_NAME', 'JOB TYPE CODE', 'TAG', 'MARKET', 'LEADER_TSID', 'LEADER_NAME', 'LIFE AND HEALTH GRID CREDIT AMOUNT', 'LH_PACE_TARGET', 'GRID CREDIT AMOUNT', 'PACE_TARGET', 'EOY_TARGET', 'EOY_RANGE_AMT', 'EOQ_TARGET', 'EOQ_RANGE_AMT', 'EOM_TARGET', 'EOM_RANGE_AMT', 'ABOVE/BELOW', 'ABOVE_BELOW_LH', 'PRIOR ADVISOR EXPERIENCE INDICATOR', 'CURR_WK_IND'}),    #'RENAMED COLUMNS' = TABLE.RENAMECOLUMNS(#'REORDERED COLUMNS',{{'ABOVE/BELOW', 'ABOVE_BELOW'}}),    #'FILTERED ROWS' = TABLE.SELECTROWS(#'RENAMED COLUMNS', EACH [TENURE_MONTHS] >= 0),    #'MERGED QUERIES' = TABLE.NESTEDJOIN(#'FILTERED ROWS', {'TSID'}, #'12_31 PACE EXPORT', {'TSID'}, '12_31 PACE EXPORT', JOINKIND.LEFTOUTER),    #'EXPANDED 12_31 PACE EXPORT' = TABLE.EXPANDTABLECOLUMN(#'MERGED QUERIES', '12_31 PACE EXPORT', {'EOY PACE TARGET', 'ABOVE/BELOW EOY'}, {'EOY PACE TARGET', 'ABOVE/BELOW EOY'})IN    #'EXPANDED 12_31 PACE EXPORT	





Source Tables: ['DM_01', 'ENTERPRISEDATAMART.DM_01.SALE_HIER_DIM', 'ENTERPRISEDATAMART.DM_01']
{'TENURE_MONTHS': ['SOURCE SYSTEM KEY TEXT', 'ADJUSTED SERVICE DATE', 'TENURE DATA', 'PROCESS DATE'], 'EOQ_RANGE_AMT': ['GRID CREDIT RANGE AMOUNT'], 'ORGANIZATION LEAD DIMENSION SURROGATE KEY': [], 'LIFE AND HEALTH GRID CREDIT AMOUNT': [], 'CURRENT_QTR': ['DATEADD', 'DD', 'QQ', 'DATEDIFF', 'GETDATE'], 'PACE PERFORMANCE TARGET DIMENSION SURROGATE KEY': [], 'PRIOR ADVISOR EXPERIENCE INDICATOR': [], 'PACE_TARGET': ['PRORATED GRID CREDIT AMOUNT'], 'EOQ_MONTH': ['SOURCE SYSTEM KEY TEXT', 'ADJUSTED SERVICE DATE', 'TENURE DATA'], 'SNAPSHOT TYPE CODE': [], 'LEADER_NAME': ['FIRST NAME', 'LAST NAME'], 'PACE PERFORMANCE TARGET VERSION NUMBER': [], 'ABOVE_BELOW_LH': ['PRIOR ADVISOR EXPERIENCE INDICATOR', 'JOB TYPE CODE', ' WHEN A.LIFE AND HEALTH GRID CREDIT AMOUNT', 'LIFE AND HEALTH PRORATED GRID CREDIT AMOUNT', 'LIFE AND HEALTH GRID CREDIT AMOUNT'], 'PREVIOUS_QTR': ['DATEADD', 'DD', 'QQ', 'DATEDIFF', 'GETDATE'], 'ABOVE_BELOW': ['PRIOR ADVISOR EXPERIENCE INDICATOR', 'JOB TYPE CODE', ' WHEN A.GRID CREDIT AMOUNT', 'PRORATED GRID CREDIT AMOUNT', 'GRID CREDIT AMOUNT'], 'ORGANIZATION DIMENSION SURROGATE KEY': [], 'LEADER_TSID': ['SOURCE SYSTEM KEY TEXT'], 'EOY_MONTH': ['SOURCE SYSTEM KEY TEXT', 'ADJUSTED SERVICE DATE', 'TENURE DATA'], 'ORGANIZATION DIMENSION VERSION NUMBER': [], 'EOQ_TENURE': ['SOURCE SYSTEM KEY TEXT', 'ADJUSTED SERVICE DATE', 'TENURE DATA'], 'BUSINESS INTERRUPTION DAY VALUE': [], 'MONTH': ['SOURCE SYSTEM KEY TEXT', 'ADJUSTED SERVICE DATE', 'TENURE DATA'], 'EOY_RANGE_AMT': ['GRID CREDIT RANGE AMOUNT'], 'TSID': ['SOURCE SYSTEM KEY TEXT'], 'EOM_TARGET': ['GRID CREDIT AMOUNT'], 'JOB TYPE CODE': [], 'LH_PACE_TARGET': ['LIFE AND HEALTH PRORATED GRID CREDIT AMOUNT'], 'EOM_TENURE': ['SOURCE SYSTEM KEY TEXT', 'ADJUSTED SERVICE DATE', 'TENURE DATA'], 'PROCESS DATE': [], 'ORGANIZATION LEAD DIMENSION VERSION NUMBER': [], 'EOM_RANGE_AMT': ['GRID CREDIT RANGE AMOUNT'], 'QUARTER_END': ['GETDATE', 'DATEFROMPARTS', 'YEAR', 'DATEADD', 'DD', 'QQ', 'DATEDIFF', 'ELSE'], 'PRODUCTION DATE': [], 'FP_NAME': ['FIRST NAME', 'LAST NAME'], 'MARKET': [], 'CURR_WK_IND': ['PROCESS DATE', 'MAX PROCESS DATE'], 'EOY_TENURE': ['SOURCE SYSTEM KEY TEXT', 'ADJUSTED SERVICE DATE', 'TENURE DATA'], 'EOQ_TARGET': ['GRID CREDIT AMOUNT'], 'TAG': ['ORZN_ZONE_CDE'], 'GRID CREDIT AMOUNT': [], 'EOY_TARGET': ['GRID CREDIT AMOUNT'], 'TENURE DATA': ['SOURCE SYSTEM KEY TEXT', 'ADJUSTED SERVICE DATE', 'TENURE DATA']}




9)

SELECT PERS_DIM.[SOURCE SYSTEM KEY TEXT] AS THRIVENTID,        PERS_DIM.[FIRST NAME] + ' ' + PERS_DIM.[LAST NAME] AS CLIENTNAME,        APPT_FCT.[WORKER APPOINTMENT ASSOCIATION],        APPT_FCT.[APPOINTMENT DIMENSION SURROGATE KEY],        APPT_FCT.[PERSON DIMENSION SURROGATE KEY],        SUM(APPT_FCT.[APPOINTMENT OCCURS]) [APPT_OCCURS],        MAX(APPT_FCT.[PERSON OCCURS]) [PERSON OCCURS],        MBR_DIM.[MEMBERSHIP TYPE DESCRIPTION],     CASE WHEN APPT_DIM.[FIELD USER COUNT] <> 0 AND APPT_DIM.[APPOINTMENT TYPE CODE] IN ('CONNECT','GATHER DATA','TAKE ACTION','STRATEGY CALL/MEETING','REVIEW','SERVICE','DISCOVER','DELIVER')    THEN 1    ELSE 0     END [JFW_IND],        APPT_DIM.[APPOINTMENT DATE],        CASE WHEN APPT_DIM.[APPOINTMENT TYPE CODE] IN ('GATHER DATA') THEN 'DISCOVER'             WHEN APPT_DIM.[APPOINTMENT TYPE CODE] IN ('TAKE ACTION') THEN 'DELIVER'             WHEN APPT_DIM.[APPOINTMENT TYPE CODE] NOT IN ('GATHER DATA','TAKE ACTION') THEN APPT_DIM.[APPOINTMENT TYPE DESCRIPTION]        END AS [APPOINTMENT TYPE CODE],        DATE_DIM.[CALENDAR YEAR NAME] AS [PERFORMANCE YEAR NAME],        ORG_DIM.[SOURCE SYSTEM KEY TEXT] [EMP_ID],        ORG_DIM.[FIRST NAME] + ' ' + ORG_DIM.[LAST NAME] [EMP_NM]    FROM ENTERPRISEDATAMART.DM_01.[APPOINTMENT COMBINE FACT] APPT_FCT LEFT JOIN         ENTERPRISEDATAMART.DM_01.[PERSON DIMENSION] AS PERS_DIM     ON (APPT_FCT.[PERSON DIMENSION SURROGATE KEY]=PERS_DIM.[PERSON DIMENSION SURROGATE KEY] AND         APPT_FCT.[PERSON DIMENSION VERSION NUMBER] = PERS_DIM.[PERSON DIMENSION VERSION NUMBER]) LEFT JOIN        ENTERPRISEDATAMART.DM_01.[MEMBERSHIP TYPE DIMENSION] MBR_DIM     ON (APPT_FCT.[MEMBERSHIP TYPE DIMENSION SURROGATE KEY]=MBR_DIM.[MEMBERSHIP TYPE DIMENSION SURROGATE KEY]) LEFT JOIN         ENTERPRISEDATAMART.DM_01.[APPOINTMENT DIMENSION] APPT_DIM     ON (APPT_FCT.[APPOINTMENT DIMENSION SURROGATE KEY]=APPT_DIM.[APPOINTMENT DIMENSION SURROGATE KEY]) LEFT JOIN         ENTERPRISEDATAMART.DM_01.[DATE DIMENSION] DATE_DIM     ON (APPT_DIM.[APPOINTMENT DATE]=DATE_DIM.[CALENDAR DATE DATE]) LEFT JOIN         ENTERPRISEDATAMART.DM_01.[ORGANIZATION DIMENSION] ORG_DIM     ON ((APPT_FCT.[APPOINTMENT ORGANIZATION DIMENSION SURROGATE KEY]=ORG_DIM.[ORGANIZATION DIMENSION SURROGATE KEY]) AND         ((ORG_DIM.[EFFECTIVE BEGIN DATE] <= APPT_DIM.[APPOINTMENT DATE]) AND (APPT_DIM.[APPOINTMENT DATE] <= ORG_DIM.[EFFECTIVE END DATE]))) LEFT JOIN           ENTERPRISEDATAMART.DM_01.[SALE_HIER_DIM] SALE_HIER_DIM     ON ((ORG_DIM.[SOURCE SYSTEM KEY TEXT]=SALE_HIER_DIM.[SALE_HIER_ID] AND  (SALE_HIER_DIM.EFF_BEG_DT<=APPT_DIM.[APPOINTMENT DATE]) AND  (APPT_DIM.[APPOINTMENT DATE]<= SALE_HIER_DIM.EFF_END_DT) AND    SALE_HIER_DIM.CURR_ROW_IND = 'Y'))  WHERE APPT_DIM.[CURRENT ROW INDICATOR] = 'Y'   AND APPT_DIM.[APPOINTMENT CREATE DATE OVER 14 DAYS] = 'N'   AND APPT_FCT.[PERSON DIMENSION SURROGATE KEY] <> 0   AND APPT_FCT.[APPOINTMENT STATUS NAME] <> 'DECLINED'   AND APPT_DIM.[APPOINTMENT TYPE CODE] <> 'UNK'   AND SALE_HIER_DIM.ORZN_DEPT_CDE IN ('0115','0165','0190','0240','0283','0291','0361','0365', '0383','0384','0410','0435','0475','0496','0525','0529','0810')  AND (ORG_DIM.[JOB TYPE CODE] IN ('002000', '002003', '002008', '002010', '002011', '002012', '002016', '002022', '002024', '002025', '002026', '002027', '003100', '003500')   OR  ORG_DIM.[DEPARTMENT IDENTIFIER] IN ('5405','5407','5408','5409','1701','1702','1703','0383'))    AND APPT_DIM.[EVENT RESULT DESCRIPTION] NOT IN ('NO SHOW','CANCELLED')   AND DATE_DIM.[CALENDAR YEAR NAME] IN ('2024')   GROUP BY   APPT_FCT.[WORKER APPOINTMENT ASSOCIATION],   APPT_FCT.[APPOINTMENT DIMENSION SURROGATE KEY],   APPT_FCT.[PERSON DIMENSION SURROGATE KEY],   MBR_DIM.[MEMBERSHIP TYPE DESCRIPTION],   APPT_DIM.[FIELD USER COUNT],   APPT_DIM.[APPOINTMENT DATE],   APPT_DIM.[APPOINTMENT TYPE CODE],   APPT_DIM.[APPOINTMENT TYPE DESCRIPTION],   DATE_DIM.[CALENDAR YEAR NAME],   ORG_DIM.[SOURCE SYSTEM KEY TEXT],   ORG_DIM.[FIRST NAME] + ' ' + ORG_DIM.[LAST NAME],   PERS_DIM.[SOURCE SYSTEM KEY TEXT],   PERS_DIM.[FIRST NAME] + ' ' + PERS_DIM.[LAST NAME]   HAVING  SUM(APPT_FCT.[APPOINTMENT OCCURS]) > 0 ']),    #'FILTERED ROWS1' = TABLE.SELECTROWS(SOURCE, EACH ([WORKER APPOINTMENT ASSOCIATION] = 'OWNER')),    #'FILTERED ROWS' = TABLE.SELECTROWS(#'FILTERED ROWS1', EACH ([APPOINTMENT TYPE CODE] = 'CONNECT') AND ([MEMBERSHIP TYPE DESCRIPTION] <> 'BENEFIT')),    #'CHANGED TYPE' = TABLE.TRANSFORMCOLUMNTYPES(#'FILTERED ROWS',{{'APPOINTMENT DATE', TYPE DATE}, {'THRIVENTID', INT64.TYPE}})IN    #'CHANGED TYPE	




Source Tables: ['ENTERPRISEDATAMART.DM_01']
{'APPOINTMENT DATE': [], 'JFW_IND': ['FIELD USER COUNT', 'APPOINTMENT TYPE CODE'], 'PERFORMANCE YEAR NAME': ['CALENDAR YEAR NAME'], 'APPOINTMENT DIMENSION SURROGATE KEY': [], 'APPT_OCCURS': ['APPOINTMENT OCCURS'], 'APPOINTMENT TYPE CODE': ['APPOINTMENT TYPE CODE', 'APPOINTMENT TYPE DESCRIPTION'], 'PERSON OCCURS': ['PERSON OCCURS'], 'MEMBERSHIP TYPE DESCRIPTION': [], 'ASSOCIATION]': [], 'EMP_ID': ['SOURCE SYSTEM KEY TEXT'], 'EMP_NM': ['FIRST NAME', 'LAST NAME'], 'THRIVENTID': ['SOURCE SYSTEM KEY TEXT'], 'PERSON DIMENSION SURROGATE KEY': [], 'CLIENTNAME': ['FIRST NAME', 'LAST NAME']}





41)

SELECT --IA_DATES_ITRL.DT_SK AS ''DATE SURROGATE KEY'',       -- TF_FIN_CUST_EVT_FCT_CFDL.CTRC_VRSN_NBR AS ''CONTRACT VERSION NUMBER'',       -- TF_FIN_CUST_EVT_FCT_CFDL.WRTG_AGT_VRSN_NBR AS ''WRITING AGENT VERSION NUMBER'',        TF_FIN_CUST_EVT_FCT_CFDL.FIN_CUST_PNT_STS_CDE AS ''FINANCIAL CUSTOMER POINT STATUS CODE'',       -- TF_FIN_CUST_EVT_FCT_CFDL.CUST_AGE AS ''FINANCIAL CUSTOMER AGE'',       -- TF_FIN_CUST_EVT_FCT_CFDL.AGE_CLAS_CDE AS ''AGE CLASS CODE'',       -- TF_FIN_CUST_EVT_FCT_CFDL.AGE_CLAS_DSCR AS ''AGE CLASS DESCRIPTION'',        TF_FIN_CUST_EVT_FCT_CFDL.FIN_CUST_PNT_VLU AS ''FINANCIAL CUSTOMER POINT VALUE'',        CNF_CUSTOMER_DIM_CFDL.CUST_ID_NBR,        CNF_CUSTOMER_DIM_CFDL.CUST_LGAL_FMT_NM,         --CNF_CUSTOMER_DIM_CFDL.CUST_BRTH_DT,       -- CNF_CUSTOMER_DIM_CFDL.MBR_TYP_CDE AS ''MEMBER TYPE CODE'',       -- CNF_CUSTOMER_DIM_CFDL.MBR_TYP_DSCR AS ''MEMBER TYPE DESCRIPTION'',       -- CNF_CUSTOMER_DIM_CFDL.RSDL_ST_CDE AS ''RESIDENTIAL STATE CODE'',        CNF_CONTRACT_DIM_DTL_CFDL.CTRC_ISS_DT AS ''CONTRACT ISSUE DATE'',        -- CNF_CONTRACT_DIM_DTL_CFDL.L5_PLOB_SGRP_CDE AS ''LEVEL 5 PRODUCT LINE OF BUSINESS SUBGROUP CODE'',       -- CNF_CONTRACT_DIM_DTL_CFDL.L5_PLOB_SGRP_DSCR AS ''LEVEL 5 PRODUCT LINE OF BUSINESS SUBGROUP DESCRIPTION'',       -- CNF_CONTRACT_DIM_DTL_CFDL.L4_PLOB_GRP_CDE AS ''LEVEL 4 PRODUCT LINE OF BUSINESS GROUP CODE'',       -- CNF_CONTRACT_DIM_DTL_CFDL.L4_PLOB_GRP_DSCR AS ''LEVEL 4 PRODUCT LINE OF BUSINESS GROUP DESCRIPTION'',        CNF_CONTRACT_DIM_DTL_CFDL.L3_PROD_LOB_CDE AS ''LEVEL 3 PRODUCT LINE OF BUSINESS CODE'',        CNF_CONTRACT_DIM_DTL_CFDL.L3_PROD_LOB_DSCR AS ''LEVEL 3 PRODUCT LINE OF BUSINESS DESCRIPTION'',      --  CNF_CONTRACT_DIM_DTL_CFDL.L2_PROD_CHAR_CDE AS ''LEVEL 2 PRODUCT CHARACTER CODE'',       -- CNF_CONTRACT_DIM_DTL_CFDL.L2_PROD_CHAR_DSCR AS ''LEVEL 2 PRODUCT CHARACTER DESCRIPTION'',       -- AGT_DIM_CURR_CFDL.PARY_DSPL_2_NM AS ''ASSIGNED FR'',       -- AGT_DIM_CURR_CFDL.FRST_NM AS ''EMPLOYEE FIRST NAME'',       -- AGT_DIM_CURR_CFDL.MDDL_NM AS ''EMPLOYEE MIDDLE NAME'',       -- AGT_DIM_CURR_CFDL.LST_NM AS ''EMPLOYEE LAST NAME'',       AGT_DIM_CURR_CFDL.FRST_NM || ' ' || AGT_DIM_CURR_CFDL.LST_NM AS EMPL_NM,       -- AGT_DIM_CURR_CFDL.ADJ_SVC_DT AS ''ADJUSTED SERVICE DATE'',        AGT_DIM_CURR_CFDL.EMP_ID AS ''TS ID'',       -- AGT_DIM_CURR_CFDL.EMP_STS_TYP_CDE AS ''EMPLOYEE STATUS TYPE CODE'',       -- AGT_DIM_CURR_CFDL.EMP_STS_TYP_DSCR AS ''EMPLOYEE STATUS TYPE DESCRIPTION'',       -- AGT_DIM_CURR_CFDL.JOB_TYP_CDE AS ''JOB TYPE CODE'',       -- AGT_DIM_CURR_CFDL.JOB_TYP_DSCR AS ''JOB TYPE DESCRIPTION'',       -- AGT_DIM_CURR_CFDL.CURR_ROW_IND AS ''CURRENT ROW INDICATOR SALES HIERARCHY'',        IA_DATES_ITRL.CAL_DAY_DT AS ''CALENDAR DATE'',        --IA_DATES_ITRL.CAL_MTH_NM,       -- IA_DATES_ITRL.CAL_MTH_STRT_DT AS ''CALENDAR MONTH STATE DATE'',       -- IA_DATES_ITRL.CAL_MTH_END_DT AS ''CALENDAR MONTH END DATE'',        --IA_DATES_ITRL.CAL_YR_QTR_NBR,        --IA_DATES_ITRL.CAL_QTR_NM,        --IA_DATES_ITRL.CAL_WK_NM,        FIN_CUST_ELIG_DIM_CFDL.FIN_CUST_PNT_RSN_CDE AS ''FINANCIAL CUSTOMER POINT REASON CODE'',        FIN_CUST_ELIG_DIM_CFDL.FIN_CUST_PNT_RSN_DSCR AS ''FINANCIAL CUSTOMER POINT REASON DESCRIPTION'',        FIN_CUST_ELIG_DIM_CFDL.CTRC_RLTN_TYP_CDE AS ''FINANCIAL CUSTOMER POINT RELATIONSHIP CODE'',        FIN_CUST_ELIG_DIM_CFDL.CTRC_RLTN_TYP_DSCR AS ''FINANCIAL CUSTOMER POINT RELATIONSHIP DESCRIPTION'',       -- CASE       --    WHEN (CUST_AGE >= 0) AND (CUST_AGE <= 15) THEN '0-15'       --    WHEN (CUST_AGE >= 16) AND (CUST_AGE <= 25) THEN '16-25'       --    WHEN (CUST_AGE >= 26) AND (CUST_AGE <= 35) THEN '26-35'       --    WHEN (CUST_AGE >= 36) AND (CUST_AGE <= 45) THEN '36-45'       --    WHEN (CUST_AGE >= 46) AND (CUST_AGE <= 55) THEN '46-55'       --    WHEN (CUST_AGE >= 56) AND (CUST_AGE <= 65) THEN '56-65'       --    WHEN (CUST_AGE >= 66) AND (CUST_AGE <= 75) THEN '66-75'       --    WHEN CUST_AGE > 75 THEN '76+'       -- END       --    AS ''FINANCIAL CUSTOMER AGE GROUP'',       -- INTEGER (FLOOR ( (CURRENT DATE - CUST_BRTH_DT) / 10000)) AS ''MEMBER AGE'',       -- DTRB_PERF_DATES.DTRB_PERF_RPT_WK_END_DT AS ''DISTRIBUTION PERFORMANCE REPORTING WEEK END DATE'',       -- DTRB_PERF_DATES.DTRB_PERF_RPT_WK_NBR AS ''DISTRIBUTION PERFORMANCE REPORTING WEEK NUMBER'',        DTRB_PERF_DATES.DTRB_PERF_RPT_YR_NBR AS ''DISTRIBUTION PERFORMANCE REPORTING YEAR NUMBER'',       -- DTRB_PERF_DATES.DTRB_PERF_RPT_YR_WK_NBR AS ''DISTRIBUTION PERFORMANCE REPORTING YEAR WEEK NUMBER'',       -- DTRB_PERF_DATES.DTRB_PERF_RPT_WK_TXT,        DTRB_PERF_DATES.DTRB_PERF_RPT_YR_TXT       --  DTRB_PERF_DATES.DTRB_PERF_RPT_DAY_TXT,      --  DTRB_PERF_DATES.DTRB_PERF_RPT_MTH_TXT,      --  DTRB_PERF_DATES.DTRB_PERF_RPT_QTR_TXT,      --  SALE_HIER_DIM.SALE_HIER_ID AS ''SALES HIERARCHY IDENTIFIER''        -- SALE_HIER_DIM.EFF_BEG_TMSP AS ''EFFECTIVE BEGIN TIMESTAMP'',       -- SALE_HIER_DIM.EFF_END_TMSP AS ''EFFECTIVE END TIMESTAMP'',       -- SALE_HIER_DIM.CURR_ROW_IND AS ''AGENT CURRENT ROW INDICATOR'',       -- SALE_HIER_DIM.PRTR_NM AS ''PARTNER NAME'',       -- SALE_HIER_DIM.MANP_NM AS ''MANAGING PARTNER NAME'',       -- SALE_HIER_DIM.ORZN_ZONE_CDE AS ''MARKET'',       -- SALE_HIER_DIM.ORZN_ZONE_DSCR AS ''ORGANIZATION ZONE DESCRIPTION'',       -- SALE_HIER_DIM.ORZN_DEPT_CDE AS ''RFO'',       -- SALE_HIER_DIM.ORZN_DEPT_DSCR AS ''ORGANIZATION DEPARTMENT DESCRIPTION'',       -- SALE_HIER_DIM.ORZN_DIV_CDE AS ''ORGANIZATION DIVISION CODE'',       -- SALE_HIER_DIM.ORZN_DIV_DSCR AS ''ORGANIZATION DIVISION DESCRIPTION'',       -- SALE_HIER_DIM.SALE_HIER_DIM_SK AS ''SALES HIERARCHY DIMENSION SURROGATE KEY''    FROM ((((((COMMON.IA_DATES_ITRL IA_DATES_ITRL INNER JOIN              COMMON.DTRB_PERF_DATES DTRB_PERF_DATES           ON (IA_DATES_ITRL.DT_SK = DTRB_PERF_DATES.DT_SK)) LEFT OUTER JOIN              SALES.TF_FIN_CUST_EVT_FCT_CFDL TF_FIN_CUST_EVT_FCT_CFDL           ON (IA_DATES_ITRL.DT_SK = TF_FIN_CUST_EVT_FCT_CFDL.FIN_CUST_CRNG_DT_SK)) RIGHT OUTER JOIN              HUMAN_RESOURCES.SALE_HIER_DIM SALE_HIER_DIM           ON (SALE_HIER_DIM.SALE_HIER_DIM_SK = TF_FIN_CUST_EVT_FCT_CFDL.SLHR_DIM_CURR_CRNG_AGT_SK)) LEFT OUTER JOIN              MEMBER.CNF_CUSTOMER_DIM_CFDL CNF_CUSTOMER_DIM_CFDL           ON (CNF_CUSTOMER_DIM_CFDL.CUST_SK = TF_FIN_CUST_EVT_FCT_CFDL.CUST_SK)) LEFT OUTER JOIN              HUMAN_RESOURCES.AGT_DIM_CURR_CFDL AGT_DIM_CURR_CFDL           ON (AGT_DIM_CURR_CFDL.AGT_DIM_SK = TF_FIN_CUST_EVT_FCT_CFDL.CRNG_AGT_SK)) RIGHT OUTER JOIN              SALES.FIN_CUST_ELIG_DIM_CFDL FIN_CUST_ELIG_DIM_CFDL           ON (FIN_CUST_ELIG_DIM_CFDL.FIN_CUST_PNT_ELIG_DIM_SK = TF_FIN_CUST_EVT_FCT_CFDL.FIN_CUST_PNT_ELIG_DIM_SK)) LEFT OUTER JOIN              CONTRACT.CNF_CONTRACT_DIM_DTL_CFDL CNF_CONTRACT_DIM_DTL_CFDL           ON (CNF_CONTRACT_DIM_DTL_CFDL.CTRC_SK = TF_FIN_CUST_EVT_FCT_CFDL.CTRC_SK) AND               (CNF_CONTRACT_DIM_DTL_CFDL.VRSN_NBR = TF_FIN_CUST_EVT_FCT_CFDL.CTRC_VRSN_NBR)                        WHERE (AGT_DIM_CURR_CFDL.CURR_ROW_IND = 'Y')    AND (SALE_HIER_DIM.CURR_ROW_IND = 'Y')    AND (SALE_HIER_DIM.ORZN_DEPT_CDE IN ('0001', '0115','0165','0190','0240','0283','0291','0361','0365','0384','0410','0435','0475','0496','0525','0529','0810')     OR AGT_DIM_CURR_CFDL.ORZN_DEPT_CDE IN ('5405','5407','5408','5409','1701','1702','1703','0383'))   AND DTRB_PERF_DATES.DTRB_PERF_RPT_YR_NBR IN ('2021','2022','2023','2024')    AND SUBSTRING(SALE_HIER_DIM.SALE_HIER_ID,1,2)='TS'    AND TF_FIN_CUST_EVT_FCT_CFDL.FIN_CUST_PNT_VLU <> 0']),    #'CHANGED TYPE' = TABLE.TRANSFORMCOLUMNTYPES(SOURCE,{{'CALENDAR DATE', TYPE DATE}, {'CONTRACT ISSUE DATE', TYPE DATE}}),    #'ADDED CUSTOM' = TABLE.ADDCOLUMN(#'CHANGED TYPE', 'TRIM TSID', EACH TEXT.TRIM([TS ID]))IN    #'ADDED CUSTOM








Source Tables: ['HUMAN_RESOURCES.AGT_DIM_CURR_CFDL', 'CONTRACT.CNF_CONTRACT_DIM_DTL_CFDL', 'HUMAN_RESOURCES.SALE_HIER_DIM', 'MEMBER.CNF_CUSTOMER_DIM_CFDL', 'SALES.FIN_CUST_ELIG_DIM_CFDL', 'SALES.TF_FIN_CUST_EVT_FCT_CFDL', 'COMMON.DTRB_PERF_DATES']
{'MEMBER AGE': ['INTEGER (FLOOR ( (CURRENT DATE - CUST_BRTH_DT) / 10000))'], 'ORGANIZATION DEPARTMENT DESCRIPTION': ['SALE_HIER_DIM.ORZN_DEPT_DSCR'], 'CUST_ID_NBR': [], 'CONTRACT VERSION NUMBER': ['TF_FIN_CUST_EVT_FCT_CFDL.CTRC_VRSN_NBR'], 'EMPLOYEE FIRST NAME': ['AGT_DIM_CURR_CFDL.FRST_NM'], 'FINANCIAL CUSTOMER POINT RELATIONSHIP CODE': ['FIN_CUST_ELIG_DIM_CFDL.CTRC_RLTN_TYP_CDE'], 'RFO': ['SALE_HIER_DIM.ORZN_DEPT_CDE'], 'CAL_WK_NM': [], 'CAL_QTR_NM': [], 'CURRENT ROW INDICATOR SALES HIERARCHY': ['AGT_DIM_CURR_CFDL.CURR_ROW_IND'], 'DTRB_PERF_RPT_MTH_TXT': [], 'CALENDAR MONTH STATE DATE': ['IA_DATES_ITRL.CAL_MTH_STRT_DT'], 'FINANCIAL CUSTOMER POINT STATUS CODE': ['TF_FIN_CUST_EVT_FCT_CFDL.FIN_CUST_PNT_STS_CDE'], 'ORGANIZATION DIVISION CODE': ['SALE_HIER_DIM.ORZN_DIV_CDE'], 'MARKET': ['SALE_HIER_DIM.ORZN_ZONE_CDE'], 'DATE SURROGATE KEY': ['IA_DATES_ITRL.DT_SK'], 'DISTRIBUTION PERFORMANCE REPORTING YEAR WEEK NUMBER': ['DTRB_PERF_DATES.DTRB_PERF_RPT_YR_WK_NBR'], 'SALES HIERARCHY DIMENSION SURROGATE KEY': ['SALE_HIER_DIM.SALE_HIER_DIM_SK'], 'EMPL_NM': ['FRST_NM', 'LST_NM'], 'CALENDAR MONTH END DATE': ['IA_DATES_ITRL.CAL_MTH_END_DT'], 'CAL_YR_QTR_NBR': [], 'CONTRACT ISSUE DATE': ['CNF_CONTRACT_DIM_DTL_CFDL.CTRC_ISS_DT'], 'LEVEL 5 PRODUCT LINE OF BUSINESS SUBGROUP DESCRIPTION': ['CNF_CONTRACT_DIM_DTL_CFDL.L5_PLOB_SGRP_DSCR'], 'CUST_LGAL_FMT_NM': [], 'DTRB_PERF_RPT_QTR_TXT': [], 'FINANCIAL CUSTOMER AGE': ['TF_FIN_CUST_EVT_FCT_CFDL.CUST_AGE'], 'DTRB_PERF_RPT_DAY_TXT': ['DTRB_PERF_RPT_YR_TXT'], 'AGE CLASS DESCRIPTION': ['TF_FIN_CUST_EVT_FCT_CFDL.AGE_CLAS_DSCR'], 'CUST_BRTH_DT': [], 'EFFECTIVE END TIMESTAMP': ['SALE_HIER_DIM.EFF_END_TMSP'], 'ADJUSTED SERVICE DATE': ['AGT_DIM_CURR_CFDL.ADJ_SVC_DT'], 'DISTRIBUTION PERFORMANCE REPORTING YEAR NUMBER': ['DTRB_PERF_DATES.DTRB_PERF_RPT_YR_NBR'], 'AGENT CURRENT ROW INDICATOR': ['SALE_HIER_DIM.CURR_ROW_IND'], 'EMPLOYEE STATUS TYPE DESCRIPTION': ['AGT_DIM_CURR_CFDL.EMP_STS_TYP_DSCR'], 'LEVEL 5 PRODUCT LINE OF BUSINESS SUBGROUP CODE': ['CNF_CONTRACT_DIM_DTL_CFDL.L5_PLOB_SGRP_CDE'], 'MANAGING PARTNER NAME': ['SALE_HIER_DIM.MANP_NM'], 'WRITING AGENT VERSION NUMBER': ['TF_FIN_CUST_EVT_FCT_CFDL.WRTG_AGT_VRSN_NBR'], 'ORGANIZATION ZONE DESCRIPTION': ['SALE_HIER_DIM.ORZN_ZONE_DSCR'], 'LEVEL 2 PRODUCT CHARACTER CODE': ['CNF_CONTRACT_DIM_DTL_CFDL.L2_PROD_CHAR_CDE'], 'CAL_MTH_NM': [], 'EFFECTIVE BEGIN TIMESTAMP': ['SALES HIERARCHY IDENTIFIER'], 'LEVEL 3 PRODUCT LINE OF BUSINESS DESCRIPTION': ['CNF_CONTRACT_DIM_DTL_CFDL.L3_PROD_LOB_DSCR'], 'EMPLOYEE MIDDLE NAME': ['AGT_DIM_CURR_CFDL.MDDL_NM'], 'JOB TYPE DESCRIPTION': ['AGT_DIM_CURR_CFDL.JOB_TYP_DSCR'], 'FINANCIAL CUSTOMER POINT REASON DESCRIPTION': ['FIN_CUST_ELIG_DIM_CFDL.FIN_CUST_PNT_RSN_DSCR'], 'EMPLOYEE STATUS TYPE CODE': ['AGT_DIM_CURR_CFDL.EMP_STS_TYP_CDE'], 'FINANCIAL CUSTOMER POINT RELATIONSHIP DESCRIPTION': ['FIN_CUST_ELIG_DIM_CFDL.CTRC_RLTN_TYP_DSCR'], 'DTRB_PERF_RPT_WK_TXT': [], 'PARTNER NAME': ['SALE_HIER_DIM.PRTR_NM'], 'ORGANIZATION DIVISION DESCRIPTION': ['SALE_HIER_DIM.ORZN_DIV_DSCR'], 'TS ID': ['AGT_DIM_CURR_CFDL.EMP_ID'], 'MEMBER TYPE CODE': ['CNF_CUSTOMER_DIM_CFDL.MBR_TYP_CDE'], 'LEVEL 3 PRODUCT LINE OF BUSINESS CODE': ['CNF_CONTRACT_DIM_DTL_CFDL.L3_PROD_LOB_CDE'], 'CALENDAR DATE': ['IA_DATES_ITRL.CAL_DAY_DT'], 'RESIDENTIAL STATE CODE': ['CNF_CUSTOMER_DIM_CFDL.RSDL_ST_CDE'], 'MEMBER TYPE DESCRIPTION': ['CNF_CUSTOMER_DIM_CFDL.MBR_TYP_DSCR'], 'ASSIGNED FR': ['AGT_DIM_CURR_CFDL.PARY_DSPL_2_NM'], 'EMPLOYEE LAST NAME': ['AGT_DIM_CURR_CFDL.LST_NM'], 'FINANCIAL CUSTOMER POINT VALUE': ['TF_FIN_CUST_EVT_FCT_CFDL.FIN_CUST_PNT_VLU'], 'FINANCIAL CUSTOMER AGE GROUP': ["CASE WHEN (CUST_AGE >= 0) AND (CUST_AGE <= 15) THEN '0-15' WHEN (CUST_AGE >= 16) AND (CUST_AGE <= 25) THEN '16-25' WHEN (CUST_AGE >= 26) AND (CUST_AGE <= 35) THEN '26-35' WHEN (CUST_AGE >= 36) AND (CUST_AGE <= 45) THEN '36-45' WHEN (CUST_AGE >= 46) AND (CUST_AGE <= 55) THEN '46-55' WHEN (CUST_AGE >= 56) AND (CUST_AGE <= 65) THEN '56-65' WHEN (CUST_AGE >= 66) AND (CUST_AGE <= 75) THEN '66-75' WHEN CUST_AGE > 75 THEN '76+' END"], 'LEVEL 2 PRODUCT CHARACTER DESCRIPTION': ['CNF_CONTRACT_DIM_DTL_CFDL.L2_PROD_CHAR_DSCR'], 'FINANCIAL CUSTOMER POINT REASON CODE': ['FIN_CUST_ELIG_DIM_CFDL.FIN_CUST_PNT_RSN_CDE'], 'DISTRIBUTION PERFORMANCE REPORTING WEEK END DATE': ['DTRB_PERF_DATES.DTRB_PERF_RPT_WK_END_DT'], 'DISTRIBUTION PERFORMANCE REPORTING WEEK NUMBER': ['DTRB_PERF_DATES.DTRB_PERF_RPT_WK_NBR'], 'LEVEL 4 PRODUCT LINE OF BUSINESS GROUP CODE': ['CNF_CONTRACT_DIM_DTL_CFDL.L4_PLOB_GRP_CDE'], 'AGE CLASS CODE': ['TF_FIN_CUST_EVT_FCT_CFDL.AGE_CLAS_CDE'], 'JOB TYPE CODE': ['AGT_DIM_CURR_CFDL.JOB_TYP_CDE'], 'LEVEL 4 PRODUCT LINE OF BUSINESS GROUP DESCRIPTION': ['CNF_CONTRACT_DIM_DTL_CFDL.L4_PLOB_GRP_DSCR']}














44)


SELECT                   REF_FCT.PERS_DIM_SK,                 REF_FCT.REFR_DT,                 SUM(REF_FCT.OCCURS) [REFERRAL_OCCURS],                 DATE_DIM.[CALENDAR YEAR NAME],                 DATE_DIM.[CALENDAR YEAR WEEK NUMBER],                 SALE_HIER_DIM.ORZN_DEPT_CDE,                 SALE_HIER_DIM.ORZN_ZONE_CDE,                 ORG_DIM.[SOURCE SYSTEM KEY TEXT] AS EMP_ID,                 ORG_DIM.[ADJUSTED SERVICE DATE],                 ORG_DIM.[EMPLOYEE STATUS TYPE DESCRIPTION],                 ORG_DIM.[FINANCIAL PROFESSIONAL TENURE],                 ORG_DIM.[FINANCIAL PROFESSIONAL TENURE GROUP],                 ORG_DIM.[DEPARTMENT IDENTIFIER],                 ORG_DIM.[RFO ZONE IDENTIFIER],                 ORG_DIM.[LAST NAME]+', '+ORG_DIM.[FIRST NAME] AS ''EMPLOYEE DISPLAY NAME'',                  ORG_DIM.[JOB TYPE CODE],                 ORG_DIM.[JOB TYPE DESCRIPTION], REF_FCT.REFR_ORZN_DIM_SK, REF_FCT.REFR_PERS_DIM_SK, REF_FCT.EFF_BEG_DT    FROM [ENTERPRISEDATAMART].[DM_01].[REFERRAL_FCT] REF_FCT LEFT JOIN        ENTERPRISEDATAMART.DM_01.[DATE DIMENSION] DATE_DIM    ON (REF_FCT.[REFR_DT]=DATE_DIM.[CALENDAR DATE DATE]) LEFT JOIN        ENTERPRISEDATAMART.DM_01.[ORGANIZATION DIMENSION] ORG_DIM    ON ((REF_FCT.REFR_ORZN_DIM_SK=ORG_DIM.[ORGANIZATION DIMENSION SURROGATE KEY]) AND        (REF_FCT.REFR_ORZN_DIM_VRSN_NBR=ORG_DIM.[ORGANIZATION DIMENSION VERSION NUMBER])) LEFT JOIN        ENTERPRISEDATAMART.DM_01.[SALE_HIER_DIM] SALE_HIER_DIM    ON ((SALE_HIER_DIM.EFF_BEG_DT <= REF_FCT.REFR_DT) AND        (REF_FCT.REFR_DT <= DATEADD(DAY,-1,SALE_HIER_DIM.EFF_END_DT)) AND                  SALE_HIER_DIM.CURR_ROW_IND = 'Y' AND                  ORG_DIM.[SOURCE SYSTEM KEY TEXT]=SALE_HIER_DIM.[SALE_HIER_ID])  WHERE REF_FCT.PERS_DIM_SK <> 0   AND SALE_HIER_DIM.ORZN_DEPT_CDE IN ('0001','0115','0190','0283','0291','0361','0383','0384','0435','0525')   AND (ORG_DIM.[JOB TYPE CODE] IN ('002000', '002003', '002008', '002010', '002011', '002012', '002016', '002022', '002024', '002025', '002026', '002027', '002030', '002031', '002032', '003100', '003500')    OR  ORG_DIM.[DEPARTMENT IDENTIFIER] IN ('5405','5407','5408','5409','1701','1702','1703','0383'))  AND DATE_DIM.[CALENDAR YEAR NAME] IN ('2022','2023','2024')  GROUP BY                 REF_FCT.PERS_DIM_SK,                 REF_FCT.REFR_DT,                 DATE_DIM.[CALENDAR YEAR NAME],                 DATE_DIM.[CALENDAR YEAR WEEK NUMBER],                 SALE_HIER_DIM.ORZN_DEPT_CDE,                 SALE_HIER_DIM.ORZN_ZONE_CDE,                 ORG_DIM.[SOURCE SYSTEM KEY TEXT],                 ORG_DIM.[ADJUSTED SERVICE DATE],                 ORG_DIM.[EMPLOYEE STATUS TYPE DESCRIPTION],                 ORG_DIM.[FINANCIAL PROFESSIONAL TENURE],                 ORG_DIM.[FINANCIAL PROFESSIONAL TENURE GROUP],                 ORG_DIM.[DEPARTMENT IDENTIFIER],                 ORG_DIM.[RFO ZONE IDENTIFIER],                 ORG_DIM.[LAST NAME]+', '+ORG_DIM.[FIRST NAME],                 ORG_DIM.[JOB TYPE CODE],                 ORG_DIM.[JOB TYPE DESCRIPTION], REF_FCT.REFR_ORZN_DIM_SK, REF_FCT.REFR_PERS_DIM_SK, REF_FCT.EFF_BEG_DT  HAVING  SUM(REF_FCT.OCCURS) > 0']),    #'CHANGED TYPE' = TABLE.TRANSFORMCOLUMNTYPES(SOURCE,{{'REFR_DT', TYPE DATE}}),    #'FILTERED ROWS' = TABLE.SELECTROWS(#'CHANGED TYPE', EACH ([REFR_PERS_DIM_SK] <> 0)),    #'SORTED ROWS' = TABLE.BUFFER(TABLE.SORT(#'FILTERED ROWS',{{'EFF_BEG_DT', ORDER.DESCENDING}})),    #'REMOVED DUPLICATES' = TABLE.DISTINCT(#'SORTED ROWS', {'PERS_DIM_SK'}),    #'ADDED INDEX' = TABLE.ADDINDEXCOLUMN(#'REMOVED DUPLICATES', 'REFERRAL KEY', 0, 1, INT64.TYPE)IN    #'ADDED INDEX	





Source Tables: ['ENTERPRISEDATAMART.DM_01.REFERRAL_FCT', 'ENTERPRISEDATAMART.DM_01']
{'EMPLOYEE STATUS TYPE DESCRIPTION': [], 'CALENDAR YEAR NAME': [], 'EMP_ID': ['SOURCE SYSTEM KEY TEXT'], 'ORZN_ZONE_CDE': [], 'DEPARTMENT IDENTIFIER': [], 'CALENDAR YEAR WEEK NUMBER': [], 'REFR_PERS_DIM_SK': [], 'REFR_DT': [], 'ORZN_DEPT_CDE': [], 'FINANCIAL PROFESSIONAL TENURE': [], 'RFO ZONE IDENTIFIER': [], 'JOB TYPE DESCRIPTION': [], 'EFF_BEG_DT': [], 'PERS_DIM_SK': [], 'FINANCIAL PROFESSIONAL TENURE GROUP': [], 'JOB TYPE CODE': [], 'ADJUSTED SERVICE DATE': [], 'EMPLOYEE DISPLAY NAME': ['LAST NAME', 'FIRST NAME'], 'REFERRAL_OCCURS': [], 'REFR_ORZN_DIM_SK': []}

	





47)

SELECT *,         LAG(SVC_AGMT_STS_CDE) OVER (PARTITION BY BEN_CTRC_NBR         ORDER BY BEG_TMSP, BEN_CTRC_NBR) AS ''LAST STATUS'',         LAG(BEG_TMSP) OVER (PARTITION BY BEN_CTRC_NBR         ORDER BY BEG_TMSP, BEN_CTRC_NBR) AS ''LAG_TIME''  FROM (  SELECT  BEN_CTRC_NBR  , BEG_TMSP  , SVC_AGMT_PLAN_YR  , CASE   WHEN SVC_AGMT_TYP_CDE = 'PTAGM' THEN 'ONE TIME'   WHEN SVC_AGMT_TYP_CDE = 'OGAGM' THEN 'ONGOING'   ELSE SVC_AGMT_TYP_CDE   END AS SVC_AGMT_TYP_CDE  , CTRC_STS_EFF_DT  , CASE   WHEN SVC_AGMT_STS_CDE = 'A ' THEN 'THRIVENT CANCEL'   WHEN SVC_AGMT_STS_CDE = 'B ' THEN 'AMENDMENT REJECTED'   WHEN SVC_AGMT_STS_CDE = 'C ' THEN 'AMENDMENT APPROVED'   WHEN SVC_AGMT_STS_CDE = 'D ' THEN 'CANCEL PENDING'   WHEN SVC_AGMT_STS_CDE = 'E ' THEN 'DEATH'   WHEN SVC_AGMT_STS_CDE = 'F ' THEN 'DRAFT'   WHEN SVC_AGMT_STS_CDE = 'P ' THEN 'PENDING RENEWAL'   WHEN SVC_AGMT_STS_CDE = 'R ' THEN 'REJECTED'   WHEN SVC_AGMT_STS_CDE = 'X ' THEN 'PENDING CANCEL'   WHEN SVC_AGMT_STS_CDE = '1 ' THEN 'PENDING'   WHEN SVC_AGMT_STS_CDE = '2 ' THEN 'APPROVED'   WHEN SVC_AGMT_STS_CDE = '3 ' THEN 'DECLINED'   WHEN SVC_AGMT_STS_CDE = '5 ' THEN 'FULFILLED'   WHEN SVC_AGMT_STS_CDE = '6 ' THEN 'NIGO'   WHEN SVC_AGMT_STS_CDE = '7 ' THEN 'AMENDMENT PENDING'   WHEN SVC_AGMT_STS_CDE = '8 ' THEN 'NSF PENDING'   WHEN SVC_AGMT_STS_CDE = '9 ' THEN 'CLIENT CANCEL'   ELSE SVC_AGMT_STS_CDE   END AS SVC_AGMT_STS_CDE  , CASE   WHEN SVC_AGMT_GRP_CDE = 'BUSN' THEN 'BUSINESS'   WHEN SVC_AGMT_GRP_CDE = 'MRRY' THEN 'MARRIED'   WHEN SVC_AGMT_GRP_CDE = 'INDIV' THEN 'INDIVIDUAL'   WHEN SVC_AGMT_GRP_CDE = 'TRUST' THEN 'TRUST'   WHEN SVC_AGMT_GRP_CDE = 'DUAL' THEN 'DUAL'   ELSE SVC_AGMT_GRP_CDE   END AS SVC_AGMT_GRP_CDE  , SVC_AGMT_ISS_CDE  , SVC_AGMT_TRMN_DT  , SVAG_TRMN_RSN_CDE  , ACL_DLIV_DT  , APP_DT  , CTRC_FLMT_EXT_IND  FROM CONTRACT.SVC_AGMT_HST   UNION ALL   SELECT    BEN_CTRC_NBR  , BEG_TMSP  , SVC_AGMT_PLAN_YR  , CASE   WHEN SVC_AGMT_TYP_CDE = 'PTAGM' THEN 'ONE TIME'   WHEN SVC_AGMT_TYP_CDE = 'OGAGM' THEN 'ONGOING'   ELSE SVC_AGMT_TYP_CDE   END AS SVC_AGMT_TYP_CDE  , CTRC_STS_EFF_DT  , CASE   WHEN SVC_AGMT_STS_CDE = 'A ' THEN 'THRIVENT CANCEL'   WHEN SVC_AGMT_STS_CDE = 'B ' THEN 'AMENDMENT REJECTED'   WHEN SVC_AGMT_STS_CDE = 'C ' THEN 'AMENDMENT APPROVED'   WHEN SVC_AGMT_STS_CDE = 'D ' THEN 'CANCEL PENDING'   WHEN SVC_AGMT_STS_CDE = 'E ' THEN 'DEATH'   WHEN SVC_AGMT_STS_CDE = 'F ' THEN 'DRAFT'   WHEN SVC_AGMT_STS_CDE = 'P ' THEN 'PENDING RENEWAL'   WHEN SVC_AGMT_STS_CDE = 'R ' THEN 'REJECTED'   WHEN SVC_AGMT_STS_CDE = 'X ' THEN 'PENDING CANCEL'   WHEN SVC_AGMT_STS_CDE = '1 ' THEN 'PENDING'   WHEN SVC_AGMT_STS_CDE = '2 ' THEN 'APPROVED'   WHEN SVC_AGMT_STS_CDE = '3 ' THEN 'DECLINED'   WHEN SVC_AGMT_STS_CDE = '5 ' THEN 'FULFILLED'   WHEN SVC_AGMT_STS_CDE = '6 ' THEN 'NIGO'   WHEN SVC_AGMT_STS_CDE = '7 ' THEN 'AMENDMENT PENDING'   WHEN SVC_AGMT_STS_CDE = '8 ' THEN 'NSF PENDING'   WHEN SVC_AGMT_STS_CDE = '9 ' THEN 'CLIENT CANCEL'   ELSE SVC_AGMT_STS_CDE   END AS SVC_AGMT_STS_CDE  , CASE   WHEN SVC_AGMT_GRP_CDE = 'BUSN' THEN 'BUSINESS'   WHEN SVC_AGMT_GRP_CDE = 'MRRY' THEN 'MARRIED'   WHEN SVC_AGMT_GRP_CDE = 'INDIV' THEN 'INDIVIDUAL'   WHEN SVC_AGMT_GRP_CDE = 'TRUST' THEN 'TRUST'   WHEN SVC_AGMT_GRP_CDE = 'DUAL' THEN 'DUAL'   ELSE SVC_AGMT_GRP_CDE   END AS SVC_AGMT_GRP_CDE  , SVC_AGMT_ISS_CDE  , SVC_AGMT_TRMN_DT  , SVAG_TRMN_RSN_CDE  , ACL_DLIV_DT  , APP_DT  , CTRC_FLMT_EXT_IND  FROM CONTRACT.SVC_AGMT)  WHERE YEAR(BEG_TMSP) >= YEAR(CURRENT DATE) - 3  ORDER BY BEN_CTRC_NBR, BEG_TMSP	






Source Tables: ['CONTRACT.SVC_AGMT_HST', 'CONTRACT.SVC_AGMT']
{'LAST STATUS': ['LAG(SVC_AGMT_STS_CDE) OVER (PARTITION BY BEN_CTRC_NBR ORDER BY BEG_TMSP, BEN_CTRC_NBR)'], 'LAG_TIME': ['LAG(BEG_TMSP) OVER (PARTITION BY BEN_CTRC_NBR ORDER BY BEG_TMSP, BEN_CTRC_NBR)'], '*': []}






58)

SELECT IA_DATES_ITRL.DT_SK AS ''DATE SURROGATE KEY'',        TF_FIN_CUST_EVT_FCT_CFDL.CTRC_VRSN_NBR AS ''CONTRACT VERSION NUMBER'',        TF_FIN_CUST_EVT_FCT_CFDL.WRTG_AGT_VRSN_NBR AS ''WRITING AGENT VERSION NUMBER'',        TF_FIN_CUST_EVT_FCT_CFDL.FIN_CUST_PNT_STS_CDE AS ''FINANCIAL CUSTOMER POINT STATUS CODE'',        TF_FIN_CUST_EVT_FCT_CFDL.CUST_AGE AS ''FINANCIAL CUSTOMER AGE'',        TF_FIN_CUST_EVT_FCT_CFDL.AGE_CLAS_CDE AS ''AGE CLASS CODE'',        TF_FIN_CUST_EVT_FCT_CFDL.AGE_CLAS_DSCR AS ''AGE CLASS DESCRIPTION'',        TF_FIN_CUST_EVT_FCT_CFDL.FIN_CUST_PNT_VLU AS ''FINANCIAL CUSTOMER POINT VALUE'',        CNF_CUSTOMER_DIM_CFDL.CUST_LGAL_FMT_NM,         --CNF_CUSTOMER_DIM_CFDL.CUST_BRTH_DT,        CNF_CUSTOMER_DIM_CFDL.MBR_TYP_CDE AS ''MEMBER TYPE CODE'',        CNF_CUSTOMER_DIM_CFDL.MBR_TYP_DSCR AS ''MEMBER TYPE DESCRIPTION'',        CNF_CUSTOMER_DIM_CFDL.RSDL_ST_CDE AS ''RESIDENTIAL STATE CODE'',        CNF_CONTRACT_DIM_DTL_CFDL.CTRC_ISS_DT AS ''CONTRACT ISSUE DATE'',         CNF_CONTRACT_DIM_DTL_CFDL.L5_PLOB_SGRP_CDE AS ''LEVEL 5 PRODUCT LINE OF BUSINESS SUBGROUP CODE'',        CNF_CONTRACT_DIM_DTL_CFDL.L5_PLOB_SGRP_DSCR AS ''LEVEL 5 PRODUCT LINE OF BUSINESS SUBGROUP DESCRIPTION'',        CNF_CONTRACT_DIM_DTL_CFDL.L4_PLOB_GRP_CDE AS ''LEVEL 4 PRODUCT LINE OF BUSINESS GROUP CODE'',        CNF_CONTRACT_DIM_DTL_CFDL.L4_PLOB_GRP_DSCR AS ''LEVEL 4 PRODUCT LINE OF BUSINESS GROUP DESCRIPTION'',        CNF_CONTRACT_DIM_DTL_CFDL.L3_PROD_LOB_CDE AS ''LEVEL 3 PRODUCT LINE OF BUSINESS CODE'',        CNF_CONTRACT_DIM_DTL_CFDL.L3_PROD_LOB_DSCR AS ''LEVEL 3 PRODUCT LINE OF BUSINESS DESCRIPTION'',        CNF_CONTRACT_DIM_DTL_CFDL.L2_PROD_CHAR_CDE AS ''LEVEL 2 PRODUCT CHARACTER CODE'',        CNF_CONTRACT_DIM_DTL_CFDL.L2_PROD_CHAR_DSCR AS ''LEVEL 2 PRODUCT CHARACTER DESCRIPTION'',        AGT_DIM_CURR_CFDL.PARY_DSPL_2_NM AS ''ASSIGNED FR'',        AGT_DIM_CURR_CFDL.FRST_NM AS ''EMPLOYEE FIRST NAME'',        AGT_DIM_CURR_CFDL.MDDL_NM AS ''EMPLOYEE MIDDLE NAME'',        AGT_DIM_CURR_CFDL.LST_NM AS ''EMPLOYEE LAST NAME'',        AGT_DIM_CURR_CFDL.ADJ_SVC_DT AS ''ADJUSTED SERVICE DATE'',        AGT_DIM_CURR_CFDL.EMP_ID AS ''TS ID'',        AGT_DIM_CURR_CFDL.EMP_STS_TYP_CDE AS ''EMPLOYEE STATUS TYPE CODE'',        AGT_DIM_CURR_CFDL.EMP_STS_TYP_DSCR AS ''EMPLOYEE STATUS TYPE DESCRIPTION'',        AGT_DIM_CURR_CFDL.JOB_TYP_CDE AS ''JOB TYPE CODE'',        AGT_DIM_CURR_CFDL.JOB_TYP_DSCR AS ''JOB TYPE DESCRIPTION'',        AGT_DIM_CURR_CFDL.CURR_ROW_IND AS ''CURRENT ROW INDICATOR SALES HIERARCHY'',        IA_DATES_ITRL.CAL_DAY_DT AS ''CALENDAR DATE'',        --IA_DATES_ITRL.CAL_MTH_NM,        IA_DATES_ITRL.CAL_MTH_STRT_DT AS ''CALENDAR MONTH STATE DATE'',        IA_DATES_ITRL.CAL_MTH_END_DT AS ''CALENDAR MONTH END DATE'',        --IA_DATES_ITRL.CAL_YR_QTR_NBR,        --IA_DATES_ITRL.CAL_QTR_NM,        --IA_DATES_ITRL.CAL_WK_NM,        FIN_CUST_ELIG_DIM_CFDL.FIN_CUST_PNT_RSN_CDE AS ''FINANCIAL CUSTOMER POINT REASON CODE'',        FIN_CUST_ELIG_DIM_CFDL.FIN_CUST_PNT_RSN_DSCR AS ''FINANCIAL CUSTOMER POINT REASON DESCRIPTION'',        FIN_CUST_ELIG_DIM_CFDL.CTRC_RLTN_TYP_CDE AS ''FINANCIAL CUSTOMER POINT RELATIONSHIP CODE'',        FIN_CUST_ELIG_DIM_CFDL.CTRC_RLTN_TYP_DSCR AS ''FINANCIAL CUSTOMER POINT RELATIONSHIP DESCRIPTION'',        CASE           WHEN (CUST_AGE >= 0) AND (CUST_AGE <= 15) THEN '0-15'           WHEN (CUST_AGE >= 16) AND (CUST_AGE <= 25) THEN '16-25'           WHEN (CUST_AGE >= 26) AND (CUST_AGE <= 35) THEN '26-35'           WHEN (CUST_AGE >= 36) AND (CUST_AGE <= 45) THEN '36-45'           WHEN (CUST_AGE >= 46) AND (CUST_AGE <= 55) THEN '46-55'           WHEN (CUST_AGE >= 56) AND (CUST_AGE <= 65) THEN '56-65'           WHEN (CUST_AGE >= 66) AND (CUST_AGE <= 75) THEN '66-75'           WHEN CUST_AGE > 75 THEN '76+'        END           AS ''FINANCIAL CUSTOMER AGE GROUP'',        INTEGER (FLOOR ( (CURRENT DATE - CUST_BRTH_DT) / 10000)) AS ''MEMBER AGE'',        DTRB_PERF_DATES.DTRB_PERF_RPT_WK_END_DT AS ''DISTRIBUTION PERFORMANCE REPORTING WEEK END DATE'',        DTRB_PERF_DATES.DTRB_PERF_RPT_WK_NBR AS ''DISTRIBUTION PERFORMANCE REPORTING WEEK NUMBER'',        DTRB_PERF_DATES.DTRB_PERF_RPT_YR_NBR AS ''DISTRIBUTION PERFORMANCE REPORTING YEAR NUMBER'',        DTRB_PERF_DATES.DTRB_PERF_RPT_YR_WK_NBR AS ''DISTRIBUTION PERFORMANCE REPORTING YEAR WEEK NUMBER'',        DTRB_PERF_DATES.DTRB_PERF_RPT_WK_TXT,        DTRB_PERF_DATES.DTRB_PERF_RPT_YR_TXT,        DTRB_PERF_DATES.DTRB_PERF_RPT_DAY_TXT,        DTRB_PERF_DATES.DTRB_PERF_RPT_MTH_TXT,        DTRB_PERF_DATES.DTRB_PERF_RPT_QTR_TXT,        SALE_HIER_DIM.SALE_HIER_ID AS ''SALES HIERARCHY IDENTIFIER'',        SALE_HIER_DIM.EFF_BEG_TMSP AS ''EFFECTIVE BEGIN TIMESTAMP'',        SALE_HIER_DIM.EFF_END_TMSP AS ''EFFECTIVE END TIMESTAMP'',        SALE_HIER_DIM.CURR_ROW_IND AS ''AGENT CURRENT ROW INDICATOR'',        SALE_HIER_DIM.PRTR_NM AS ''PARTNER NAME'',        SALE_HIER_DIM.MANP_NM AS ''MANAGING PARTNER NAME'',        SALE_HIER_DIM.ORZN_ZONE_CDE AS ''MARKET'',        SALE_HIER_DIM.ORZN_ZONE_DSCR AS ''ORGANIZATION ZONE DESCRIPTION'',        SALE_HIER_DIM.ORZN_DEPT_CDE AS ''RFO'',        SALE_HIER_DIM.ORZN_DEPT_DSCR AS ''ORGANIZATION DEPARTMENT DESCRIPTION'',        SALE_HIER_DIM.ORZN_DIV_CDE AS ''ORGANIZATION DIVISION CODE'',        SALE_HIER_DIM.ORZN_DIV_DSCR AS ''ORGANIZATION DIVISION DESCRIPTION'',        SALE_HIER_DIM.SALE_HIER_DIM_SK AS ''SALES HIERARCHY DIMENSION SURROGATE KEY''    FROM ((((((COMMON.IA_DATES_ITRL IA_DATES_ITRL INNER JOIN              COMMON.DTRB_PERF_DATES DTRB_PERF_DATES           ON (IA_DATES_ITRL.DT_SK = DTRB_PERF_DATES.DT_SK)) LEFT OUTER JOIN              SALES.TF_FIN_CUST_EVT_FCT_CFDL TF_FIN_CUST_EVT_FCT_CFDL           ON (IA_DATES_ITRL.DT_SK = TF_FIN_CUST_EVT_FCT_CFDL.FIN_CUST_CRNG_DT_SK)) RIGHT OUTER JOIN              HUMAN_RESOURCES.SALE_HIER_DIM SALE_HIER_DIM           ON (SALE_HIER_DIM.SALE_HIER_DIM_SK = TF_FIN_CUST_EVT_FCT_CFDL.SLHR_DIM_CURR_CRNG_AGT_SK)) LEFT OUTER JOIN              MEMBER.CNF_CUSTOMER_DIM_CFDL CNF_CUSTOMER_DIM_CFDL           ON (CNF_CUSTOMER_DIM_CFDL.CUST_SK = TF_FIN_CUST_EVT_FCT_CFDL.CUST_SK)) LEFT OUTER JOIN              HUMAN_RESOURCES.AGT_DIM_CURR_CFDL AGT_DIM_CURR_CFDL           ON (AGT_DIM_CURR_CFDL.AGT_DIM_SK = TF_FIN_CUST_EVT_FCT_CFDL.CRNG_AGT_SK)) RIGHT OUTER JOIN              SALES.FIN_CUST_ELIG_DIM_CFDL FIN_CUST_ELIG_DIM_CFDL           ON (FIN_CUST_ELIG_DIM_CFDL.FIN_CUST_PNT_ELIG_DIM_SK = TF_FIN_CUST_EVT_FCT_CFDL.FIN_CUST_PNT_ELIG_DIM_SK)) LEFT OUTER JOIN              CONTRACT.CNF_CONTRACT_DIM_DTL_CFDL CNF_CONTRACT_DIM_DTL_CFDL           ON (CNF_CONTRACT_DIM_DTL_CFDL.CTRC_SK = TF_FIN_CUST_EVT_FCT_CFDL.CTRC_SK) AND               (CNF_CONTRACT_DIM_DTL_CFDL.VRSN_NBR = TF_FIN_CUST_EVT_FCT_CFDL.CTRC_VRSN_NBR)                        WHERE (AGT_DIM_CURR_CFDL.CURR_ROW_IND = 'Y')    AND (SALE_HIER_DIM.CURR_ROW_IND = 'Y')    AND SALE_HIER_DIM.ORZN_DEPT_CDE IN ('0001', '0115','0165','0190','0240','0283','0291','0361','0365','0384','0410','0435','0475','0496','0525','0529','0810')    AND DTRB_PERF_DATES.DTRB_PERF_RPT_YR_NBR IN ('2022')']),    #'REMOVED COLUMNS' = TABLE.REMOVECOLUMNS(SOURCE,{'FINANCIAL CUSTOMER AGE', 'AGE CLASS CODE', 'AGE CLASS DESCRIPTION', 'CUST_LGAL_FMT_NM', 'MEMBER TYPE CODE', 'MEMBER TYPE DESCRIPTION', 'RESIDENTIAL STATE CODE', 'LEVEL 5 PRODUCT LINE OF BUSINESS SUBGROUP CODE', 'LEVEL 5 PRODUCT LINE OF BUSINESS SUBGROUP DESCRIPTION', 'LEVEL 4 PRODUCT LINE OF BUSINESS GROUP CODE', 'LEVEL 4 PRODUCT LINE OF BUSINESS GROUP DESCRIPTION', 'LEVEL 3 PRODUCT LINE OF BUSINESS CODE', 'LEVEL 3 PRODUCT LINE OF BUSINESS DESCRIPTION', 'LEVEL 2 PRODUCT CHARACTER CODE', 'LEVEL 2 PRODUCT CHARACTER DESCRIPTION', 'EMPLOYEE FIRST NAME', 'EMPLOYEE MIDDLE NAME', 'EMPLOYEE LAST NAME', 'ADJUSTED SERVICE DATE', 'CALENDAR MONTH STATE DATE', 'CALENDAR MONTH END DATE', 'FINANCIAL CUSTOMER POINT REASON CODE', 'FINANCIAL CUSTOMER POINT REASON DESCRIPTION', 'FINANCIAL CUSTOMER POINT RELATIONSHIP CODE', 'FINANCIAL CUSTOMER POINT RELATIONSHIP DESCRIPTION', 'FINANCIAL CUSTOMER AGE GROUP', 'MEMBER AGE', 'PARTNER NAME', 'MANAGING PARTNER NAME'})IN    #'REMOVED COLUMNS	





Source Tables: ['COMMON.DTRB_PERF_DATES', 'HUMAN_RESOURCES.AGT_DIM_CURR_CFDL', 'SALES.FIN_CUST_ELIG_DIM_CFDL', 'MEMBER.CNF_CUSTOMER_DIM_CFDL', 'HUMAN_RESOURCES.SALE_HIER_DIM', 'SALES.TF_FIN_CUST_EVT_FCT_CFDL', 'CONTRACT.CNF_CONTRACT_DIM_DTL_CFDL']
{'CALENDAR DATE': ['IA_DATES_ITRL.CAL_DAY_DT'], 'ORGANIZATION DEPARTMENT DESCRIPTION': ['SALE_HIER_DIM.ORZN_DEPT_DSCR'], 'ORGANIZATION DIVISION CODE': ['SALE_HIER_DIM.ORZN_DIV_CDE'], 'ASSIGNED FR': ['AGT_DIM_CURR_CFDL.PARY_DSPL_2_NM'], 'CURRENT ROW INDICATOR SALES HIERARCHY': ['AGT_DIM_CURR_CFDL.CURR_ROW_IND'], 'MEMBER TYPE DESCRIPTION': ['CNF_CUSTOMER_DIM_CFDL.MBR_TYP_DSCR'], 'SALES HIERARCHY IDENTIFIER': ['SALE_HIER_DIM.SALE_HIER_ID'], 'SALES HIERARCHY DIMENSION SURROGATE KEY': ['SALE_HIER_DIM.SALE_HIER_DIM_SK'], 'LEVEL 3 PRODUCT LINE OF BUSINESS CODE': ['CNF_CONTRACT_DIM_DTL_CFDL.L3_PROD_LOB_CDE'], 'EFFECTIVE BEGIN TIMESTAMP': ['SALE_HIER_DIM.EFF_BEG_TMSP'], 'LEVEL 2 PRODUCT CHARACTER DESCRIPTION': ['CNF_CONTRACT_DIM_DTL_CFDL.L2_PROD_CHAR_DSCR'], 'ORGANIZATION DIVISION DESCRIPTION': ['SALE_HIER_DIM.ORZN_DIV_DSCR'], 'FINANCIAL CUSTOMER AGE GROUP': ["CASE WHEN (CUST_AGE >= 0) AND (CUST_AGE <= 15) THEN '0-15' WHEN (CUST_AGE >= 16) AND (CUST_AGE <= 25) THEN '16-25' WHEN (CUST_AGE >= 26) AND (CUST_AGE <= 35) THEN '26-35' WHEN (CUST_AGE >= 36) AND (CUST_AGE <= 45) THEN '36-45' WHEN (CUST_AGE >= 46) AND (CUST_AGE <= 55) THEN '46-55' WHEN (CUST_AGE >= 56) AND (CUST_AGE <= 65) THEN '56-65' WHEN (CUST_AGE >= 66) AND (CUST_AGE <= 75) THEN '66-75' WHEN CUST_AGE > 75 THEN '76+' END"], 'PARTNER NAME': ['SALE_HIER_DIM.PRTR_NM'], 'CONTRACT VERSION NUMBER': ['TF_FIN_CUST_EVT_FCT_CFDL.CTRC_VRSN_NBR'], 'DISTRIBUTION PERFORMANCE REPORTING WEEK END DATE': ['DTRB_PERF_DATES.DTRB_PERF_RPT_WK_END_DT'], 'DTRB_PERF_RPT_MTH_TXT': [], 'CAL_YR_QTR_NBR': [], 'TS ID': ['AGT_DIM_CURR_CFDL.EMP_ID'], 'CALENDAR MONTH STATE DATE': ['IA_DATES_ITRL.CAL_MTH_STRT_DT'], 'EMPLOYEE FIRST NAME': ['AGT_DIM_CURR_CFDL.FRST_NM'], 'DISTRIBUTION PERFORMANCE REPORTING YEAR NUMBER': ['DTRB_PERF_DATES.DTRB_PERF_RPT_YR_NBR'], 'DTRB_PERF_RPT_YR_TXT': [], 'DTRB_PERF_RPT_DAY_TXT': [], 'FINANCIAL CUSTOMER POINT RELATIONSHIP DESCRIPTION': ['FIN_CUST_ELIG_DIM_CFDL.CTRC_RLTN_TYP_DSCR'], 'ORGANIZATION ZONE DESCRIPTION': ['SALE_HIER_DIM.ORZN_ZONE_DSCR'], 'EMPLOYEE STATUS TYPE CODE': ['AGT_DIM_CURR_CFDL.EMP_STS_TYP_CDE'], 'DTRB_PERF_RPT_WK_TXT': [], 'MANAGING PARTNER NAME': ['SALE_HIER_DIM.MANP_NM'], 'DISTRIBUTION PERFORMANCE REPORTING WEEK NUMBER': ['DTRB_PERF_DATES.DTRB_PERF_RPT_WK_NBR'], 'AGE CLASS DESCRIPTION': ['TF_FIN_CUST_EVT_FCT_CFDL.AGE_CLAS_DSCR'], 'LEVEL 5 PRODUCT LINE OF BUSINESS SUBGROUP DESCRIPTION': ['CNF_CONTRACT_DIM_DTL_CFDL.L5_PLOB_SGRP_DSCR'], 'LEVEL 5 PRODUCT LINE OF BUSINESS SUBGROUP CODE': ['CNF_CONTRACT_DIM_DTL_CFDL.L5_PLOB_SGRP_CDE'], 'RFO': ['SALE_HIER_DIM.ORZN_DEPT_CDE'], 'LEVEL 3 PRODUCT LINE OF BUSINESS DESCRIPTION': ['CNF_CONTRACT_DIM_DTL_CFDL.L3_PROD_LOB_DSCR'], 'MARKET': ['SALE_HIER_DIM.ORZN_ZONE_CDE'], 'CUST_LGAL_FMT_NM': [], 'AGE CLASS CODE': ['TF_FIN_CUST_EVT_FCT_CFDL.AGE_CLAS_CDE'], 'FINANCIAL CUSTOMER POINT VALUE': ['TF_FIN_CUST_EVT_FCT_CFDL.FIN_CUST_PNT_VLU'], 'EMPLOYEE STATUS TYPE DESCRIPTION': ['AGT_DIM_CURR_CFDL.EMP_STS_TYP_DSCR'], 'FINANCIAL CUSTOMER POINT STATUS CODE': ['TF_FIN_CUST_EVT_FCT_CFDL.FIN_CUST_PNT_STS_CDE'], 'FINANCIAL CUSTOMER POINT REASON DESCRIPTION': ['FIN_CUST_ELIG_DIM_CFDL.FIN_CUST_PNT_RSN_DSCR'], 'WRITING AGENT VERSION NUMBER': ['TF_FIN_CUST_EVT_FCT_CFDL.WRTG_AGT_VRSN_NBR'], 'DISTRIBUTION PERFORMANCE REPORTING YEAR WEEK NUMBER': ['DTRB_PERF_DATES.DTRB_PERF_RPT_YR_WK_NBR'], 'CALENDAR MONTH END DATE': ['IA_DATES_ITRL.CAL_MTH_END_DT'], 'CAL_MTH_NM': [], 'FINANCIAL CUSTOMER POINT RELATIONSHIP CODE': ['FIN_CUST_ELIG_DIM_CFDL.CTRC_RLTN_TYP_CDE'], 'EFFECTIVE END TIMESTAMP': ['SALE_HIER_DIM.EFF_END_TMSP'], 'FINANCIAL CUSTOMER POINT REASON CODE': ['FIN_CUST_ELIG_DIM_CFDL.FIN_CUST_PNT_RSN_CDE'], 'MEMBER AGE': ['INTEGER (FLOOR ( (CURRENT DATE - CUST_BRTH_DT) / 10000))'], 'MEMBER TYPE CODE': ['CNF_CUSTOMER_DIM_CFDL.MBR_TYP_CDE'], 'CUST_BRTH_DT': [], 'ADJUSTED SERVICE DATE': ['AGT_DIM_CURR_CFDL.ADJ_SVC_DT'], 'RESIDENTIAL STATE CODE': ['CNF_CUSTOMER_DIM_CFDL.RSDL_ST_CDE'], 'CAL_QTR_NM': [], 'DTRB_PERF_RPT_QTR_TXT': [], 'EMPLOYEE MIDDLE NAME': ['AGT_DIM_CURR_CFDL.MDDL_NM'], 'LEVEL 4 PRODUCT LINE OF BUSINESS GROUP CODE': ['CNF_CONTRACT_DIM_DTL_CFDL.L4_PLOB_GRP_CDE'], 'CONTRACT ISSUE DATE': ['CNF_CONTRACT_DIM_DTL_CFDL.CTRC_ISS_DT'], 'LEVEL 4 PRODUCT LINE OF BUSINESS GROUP DESCRIPTION': ['CNF_CONTRACT_DIM_DTL_CFDL.L4_PLOB_GRP_DSCR'], 'FINANCIAL CUSTOMER AGE': ['TF_FIN_CUST_EVT_FCT_CFDL.CUST_AGE'], 'DATE SURROGATE KEY': ['IA_DATES_ITRL.DT_SK'], 'JOB TYPE CODE': ['AGT_DIM_CURR_CFDL.JOB_TYP_CDE'], 'CAL_WK_NM': [], 'AGENT CURRENT ROW INDICATOR': ['SALE_HIER_DIM.CURR_ROW_IND'], 'EMPLOYEE LAST NAME': ['AGT_DIM_CURR_CFDL.LST_NM'], 'JOB TYPE DESCRIPTION': ['AGT_DIM_CURR_CFDL.JOB_TYP_DSCR'], 'LEVEL 2 PRODUCT CHARACTER CODE': ['CNF_CONTRACT_DIM_DTL_CFDL.L2_PROD_CHAR_CDE']}








66)


SELECT   REF_FCT.PERS_DIM_SK,  REF_FCT.REFR_DT,  SUM(REF_FCT.OCCURS) [REFERRAL_OCCURS],  --DATE_DIM.[PERFORMANCE YEAR NAME],  --DATE_DIM.[PERFORMANCE YEAR WEEK NUMBER],  --SALE_HIER_DIM.ORZN_DEPT_CDE,  --SALE_HIER_DIM.ORZN_ZONE_CDE,  ORG_DIM.[SOURCE SYSTEM KEY TEXT] AS EMP_ID,  --ORG_DIM.[ADJUSTED SERVICE DATE],  --ORG_DIM.[EMPLOYEE STATUS TYPE DESCRIPTION],  --ORG_DIM.[FINANCIAL PROFESSIONAL TENURE],  --ORG_DIM.[FINANCIAL PROFESSIONAL TENURE GROUP],  --ORG_DIM.[DEPARTMENT IDENTIFIER],  --ORG_DIM.[RFO ZONE IDENTIFIER],    ORG_DIM.[LAST NAME]+', '+ORG_DIM.[FIRST NAME] AS ''EMPLOYEE DISPLAY NAME''   --ORG_DIM.[JOB TYPE CODE],  --ORG_DIM.[JOB TYPE DESCRIPTION]    FROM [ENTERPRISEDATAMART].[DM_01].[REFERRAL_FCT] REF_FCT LEFT JOIN        ENTERPRISEDATAMART.DM_01.[DATE DIMENSION] DATE_DIM    ON (REF_FCT.[REFR_DT]=DATE_DIM.[CALENDAR DATE DATE]) LEFT JOIN        ENTERPRISEDATAMART.DM_01.[ORGANIZATION DIMENSION] ORG_DIM    ON ((REF_FCT.REFR_ORZN_DIM_SK=ORG_DIM.[ORGANIZATION DIMENSION SURROGATE KEY]) AND        (REF_FCT.REFR_ORZN_DIM_VRSN_NBR=ORG_DIM.[ORGANIZATION DIMENSION VERSION NUMBER])) LEFT JOIN        ENTERPRISEDATAMART.DM_01.[SALE_HIER_DIM] SALE_HIER_DIM    ON ((SALE_HIER_DIM.EFF_BEG_DT <= REF_FCT.REFR_DT) AND        (REF_FCT.REFR_DT <= DATEADD(DAY,-1,SALE_HIER_DIM.EFF_END_DT)) AND           SALE_HIER_DIM.CURR_ROW_IND = 'Y' AND   ORG_DIM.[SOURCE SYSTEM KEY TEXT]=SALE_HIER_DIM.[SALE_HIER_ID])  WHERE REF_FCT.PERS_DIM_SK <> 0   AND SALE_HIER_DIM.ORZN_DEPT_CDE IN ('0115','0165','0190','0240','0283','0291','0361','0365','0383','0384','0410','0435','0475','0496','0525','0529','0810')   AND (ORG_DIM.[JOB TYPE CODE] IN ('002000', '002003', '002008', '002010', '002011', '002012', '002016', '002022', '002024', '002025', '002026', '002027', '002030', '002031', '002032', '003100', '003500')    OR  ORG_DIM.[DEPARTMENT IDENTIFIER] IN ('5405','5407','5408','5409','1701','1702','1703','0383'))  AND DATE_DIM.[CALENDAR YEAR NAME] IN ('2021','2022','2023')  GROUP BY  REF_FCT.PERS_DIM_SK,  REF_FCT.REFR_DT,  --DATE_DIM.[PERFORMANCE YEAR NAME],  --DATE_DIM.[PERFORMANCE YEAR WEEK NUMBER],  --SALE_HIER_DIM.ORZN_DEPT_CDE,  --SALE_HIER_DIM.ORZN_ZONE_CDE,  ORG_DIM.[SOURCE SYSTEM KEY TEXT],  --ORG_DIM.[ADJUSTED SERVICE DATE],  --ORG_DIM.[EMPLOYEE STATUS TYPE DESCRIPTION],  --ORG_DIM.[FINANCIAL PROFESSIONAL TENURE],  --ORG_DIM.[FINANCIAL PROFESSIONAL TENURE GROUP],  --ORG_DIM.[DEPARTMENT IDENTIFIER],  --ORG_DIM.[RFO ZONE IDENTIFIER],           ORG_DIM.[LAST NAME]+', '+ORG_DIM.[FIRST NAME]  --ORG_DIM.[JOB TYPE CODE],  --ORG_DIM.[JOB TYPE DESCRIPTION]  HAVING  SUM(REF_FCT.OCCURS) > 0    	




Source Tables: ['ENTERPRISEDATAMART.DM_01.REFERRAL_FCT', 'ENTERPRISEDATAMART.DM_01']
{'RFO ZONE IDENTIFIER': [], 'ORZN_ZONE_CDE': [], 'JOB TYPE CODE': ['LAST NAME', 'FIRST NAME', 'EMPLOYEE DISPLAY NAME'], 'PERS_DIM_SK': [], 'JOB TYPE DESCRIPTION': [], 'REFERRAL_OCCURS': [], 'ORZN_DEPT_CDE': [], 'DEPARTMENT IDENTIFIER': [], 'EMP_ID': ['SOURCE SYSTEM KEY TEXT'], 'PERFORMANCE YEAR WEEK NUMBER': [], 'FINANCIAL PROFESSIONAL TENURE': [], 'EMPLOYEE STATUS TYPE DESCRIPTION': [], 'ADJUSTED SERVICE DATE': [], 'FINANCIAL PROFESSIONAL TENURE GROUP': [], 'REFR_DT': [], 'PERFORMANCE YEAR NAME': []}